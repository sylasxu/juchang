# 聚场 (Juchang) 产品需求文档 - V9.2 (Dev Ready)

> **核心目标**：Day 1 Profitability - 上线首日即覆盖 AI Token 及服务器成本，争取 20%+ 利润率

---

## 1. 商业模式与权益 (Business Model & Economics)

### 1.1 核心策略：Freemium + 焦虑/虚荣变现

**设计哲学**：
- 95% 免费用户维持生态活跃度
- 5% 付费用户贡献 120% 的运营成本
- 对"焦虑"（急于成局）和"虚荣"（渴望曝光）收取高溢价（零边际成本）

### 1.2 免费权益 (Free Tier)

| 功能 | 免费额度 | 说明 |
|------|----------|------|
| 发布活动 | ✅ 无限 | 核心功能免费 |
| 报名参与 | ✅ 无限 | 核心功能免费 |
| 群聊沟通 | ✅ 无限 | 核心功能免费 |
| 履约确认 | ✅ 无限 | 核心功能免费 |
| AI 建局 | 3次/天 | 超额付费 |
| AI 意图解析/搜索 | 10次/天 | 超额付费 |

### 1.3 付费增值服务 (Premium Tools)

**高利润工具矩阵**：

| 服务 | 价格 | 解决的痛点 | 利润率 |
|------|------|------------|--------|
| 🚀 **强力召唤 (Boost)** | ¥3/次 | "急缺人"的焦虑 | ~95% |
| 👑 **黄金置顶 (Pin+)** | ¥5/次 | "被看到"的虚荣 | ~95% |
| 🎫 **优先入场券 (Fast Pass)** | ¥2/次 | "插队"的需求 | ~95% |
| 🔮 **AI 深度风控报告** | ¥1/次 | "安全"的焦虑 | ~80% |
| 💬 **AI 额度包** | ¥5/10次 | AI 重度用户 | ~70% |

**服务详解**：

#### 🚀 强力召唤 (Boost)
- **功能**：向周围 3km 内所有活跃用户发送强推送通知
- **场景**：剧本杀缺1人、临时饭局急招
- **展示**：推送带"🔥急招"标签，地图Pin闪烁动效
- **限制**：同一活动最多Boost 3次，间隔≥30分钟

#### 👑 黄金置顶 (Pin+)
- **功能**：地图Pin变大(1.5x)、变金色、带光晕动效
- **时长**：24小时
- **场景**：想让活动更醒目、获得更多曝光
- **叠加**：可与Boost同时使用

#### 🎫 优先入场券 (Fast Pass)
- **功能**：申请在发起人审批列表中置顶并高亮显示
- **展示**：申请卡片带"⚡优先"标签
- **场景**：热门活动竞争激烈时抢位

#### 🔮 AI 深度风控报告
- **功能**：查看某用户的详细履约分析、差评详情、行为画像
- **内容**：履约时间线、差评原因分布、AI风险评估
- **场景**：发起人审批时想深入了解申请者

### 1.4 会员订阅 (Pro)

| 权益 | 免费用户 | Pro会员 (¥15/月) |
|------|----------|------------------|
| AI 建局 | 3次/天 | 无限 |
| AI 搜索 | 10次/天 | 无限 |
| 强力召唤 | ¥3/次 | 1次/天免费 |
| 黄金置顶 | ¥5/次 | ¥3/次 |
| 深度报告 | ¥1/次 | 免费 |
| 专属标识 | ❌ | 👑 Pro徽章 |

### 1.5 盈利模型预估

**假设**：DAU 1000，付费率 5%
```
日收入预估：
- Boost: 20次 × ¥3 = ¥60
- Pin+: 10次 × ¥5 = ¥50
- Fast Pass: 30次 × ¥2 = ¥60
- AI报告: 50次 × ¥1 = ¥50
- Pro会员: 50人 × ¥0.5/天 = ¥25
日收入合计: ¥245

日成本预估：
- 服务器: ¥50
- AI Token: ¥100
- 其他: ¥20
日成本合计: ¥170

日利润: ¥75 (利润率 44%)
```

---

## 2. 信任与履约体系 (Trust & Fulfillment)

### 2.1 核心理念：静默生效 + 一键申诉

**设计哲学**：
- 最大程度降低用户操作负担
- 默认信任，异常时才需要操作
- 避免用户间直接冲突

### 2.2 靠谱度计算

```
靠谱度 = 履约次数 / 参与次数 × 100%
```

| 靠谱度 | 展示 | 权限 |
|--------|------|------|
| 100% | ⭐⭐⭐ 非常靠谱 | 全部功能 |
| 80%+ | ⭐⭐ 靠谱 | 全部功能 |
| 60%+ | ⭐ 一般 | 无法发起需审核的活动 |
| <60% | 待提升 | 禁止发起活动，禁止报名 |
| 新用户 | 🆕 新用户 | 显示"暂无履约记录" |

### 2.3 履约流程：静默生效机制

```
┌─────────────────────────────────────────────────────────┐
│                    履约流程时序图                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  活动结束                                               │
│      │                                                  │
│      ▼                                                  │
│  发起人收到确认通知                                      │
│      │                                                  │
│      ├──── 24h内操作 ────┐                              │
│      │                   │                              │
│      ▼                   ▼                              │
│  标记到场/未到场      超时未操作                         │
│      │                   │                              │
│      │                   ▼                              │
│      │            默认全员履约 ✅                        │
│      │                                                  │
│      ▼                                                  │
│  被标记"未到场"者收到通知                                │
│      │                                                  │
│      ├──── [我到场了] 按钮                              │
│      │                                                  │
│      ▼                                                  │
│  点击申诉 → 争议状态（不扣分）                           │
│  不点击 → 24h后生效（扣分）                             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.4 申诉机制（关键设计）

**一键申诉流程**：
1. 被标记"未到场"的用户收到推送通知
2. 通知内含 **[我到场了]** 按钮
3. 用户点击即申诉成功
4. **MVP阶段处理**：视为争议，双方均不扣分，不通知发起人（避免撕逼）

**风控措施**：
- 后台记录所有 `Dispute_Action`（申诉操作）
- 滥用申诉者（申诉率>50%）将被标记风险
- 数据用于后续模型训练

### 2.5 发起人责任机制

**督促发起人负责**：
- 发起人标记他人"未到场"时，自身扣除 **1% 靠谱度**（象征性）
- 目的：防止恶意标记，鼓励真实反馈
- 若被标记者申诉成功，发起人额外扣除 **2% 靠谱度**

---

## 3. 隐私与地图逻辑 (Privacy & Map)

### 3.1 隐私分级设计

| 活动类型 | 地图展示 | 详情页 | 报名后 |
|----------|----------|--------|--------|
| 公开局 | 精确位置 | 完整地址 | 精确导航 |
| 私密局 | 模糊位置(偏移200-500m) | "某某小区附近" | 精确导航 |

**私密局设置**：
```
┌─────────────────────────────────┐
│ 创建活动                        │
├─────────────────────────────────┤
│ ...                             │
│ 🔒 隐私设置                     │
│ ☐ 模糊地理位置                  │
│   适用于家庭局/私人聚会          │
│   报名通过后才显示精确位置       │
│ ...                             │
└─────────────────────────────────┘
```

### 3.2 地图Pin类型

| 类型 | 颜色 | 说明 |
|------|------|------|
| 活动 | 🟠 橙色 | 用户发布的真实活动 |
| 人 | 🔵 蓝色 | 在线用户位置（可选展示） |
| 需求锚点 | 🟢 绿色虚线 | 运营投放的需求引导 |

### 3.3 冷启动：诚实的需求锚点

**设计原则**：严禁伪装成真实活动

**数据结构**：
```typescript
// 幽灵锚点标记
{
  is_ghost: true,
  anchor_type: "demand", // 需求引导类型
  suggested_activity_type: "food", // 建议的活动类型
  location_hint: "4楼平台入口" // 重庆地形位置备注
}
```

**锚点文案示例**：
- "这里缺一个火锅局 🍲"
- "有人想在这玩飞盘 🥏"
- "周末这里适合野餐 🧺"

**交互流程**：
```
点击需求锚点
    │
    ▼
┌─────────────────────────────────┐
│ 🍲 这里缺一个火锅局              │
├─────────────────────────────────┤
│ 附近 3km 内有 12 人对火锅感兴趣  │
│                                 │
│ [我来组这个局]                   │
│                                 │
│ 点击后复用"AI 意图解析"流程      │
│ 预填：类型=火锅，位置=当前锚点    │
└─────────────────────────────────┘
```

### 3.4 重庆地形与位置备注

**背景**：重庆 3D 地形复杂，同一地址可能有多个入口/楼层

**强制填写逻辑**：
```
┌─────────────────────────────────┐
│ 📍 选择位置                     │
├─────────────────────────────────┤
│ 地址：观音桥步行街               │
│                                 │
│ 🏢 位置备注 (必填)              │
│ ☐ 地面入口                     │
│ ☐ 地下通道进                   │
│ ☐ 4楼平台                      │
│ ☐ 其他：[自定义]               │
└─────────────────────────────────┘
```

**数据库字段**：
```typescript
activities: {
  location_hint: varchar("location_hint", { length: 100 }).notNull(),
  // 如："4楼平台入口"、"地下B1层"、"轻轨站3号出口"
}
```

---

## 4. 功能模块详解 (Functional Modules)

### 4.0 底部导航结构

**3 Tab + 1 FAB 设计**：
- **Tab 1**: 地图 (Map) - 核心首页
- **Tab 2**: 消息 (Connect) - 社交连接
- **Tab 3**: 我 (Me) - 个人中心
- **FAB**: 底部中央悬浮 [+] 按钮 - 核心创建入口

### 4.1 Tab 1: 地图 (Map)

**顶部导航栏**：
```
┌─────────────────────────────────┐
│ 🔍 全能搜索框                   │
│ "观音桥附近的火锅，要安静点的"   │
├─────────────────────────────────┤
│ 地图区域...                     │
└─────────────────────────────────┘
```

**全能搜索功能**：
- 支持自然语言输入
- 调用 AI RAG 进行意图识别
- 直接在地图上过滤和重绘 Pin
- 消耗 1 次 AI 搜索额度

**渲染逻辑**：
- 区分 活动(橙)/人(蓝)/需求锚点(绿虚线)
- 付费Pin(Pin+)：1.5x大小 + 金色 + 光晕动效
- Boost活动：闪烁动效 + "🔥急招"标签

**Upsell设计**：
```
┌─────────────────────────────────┐
│ 发布活动                        │
├─────────────────────────────────┤
│ ...填写完成...                  │
│                                 │
│ 💡 推广选项                     │
│ ☐ 🚀 强力召唤 (+¥3)            │
│   向3km内用户发送推送通知        │
│ ☐ 👑 黄金置顶 (+¥5)            │
│   地图Pin变大变金，持续24小时    │
│                                 │
│ [免费发布]  [付费发布 ¥X]       │
└─────────────────────────────────┘
```

**筛选面板**：
```
┌─────────────────────────────────┐
│ 🔍 筛选条件                      │
├─────────────────────────────────┤
│ ⏰ 时间：今天/明天/本周/不限      │
│ 🎯 类型：吃饭/娱乐/运动/学习     │
│ 👥 人群：仅限女生/男女不限       │
│ ⭐ 靠谱度：100%/80%+/不限        │
│ 📍 距离：1km/3km/5km/10km       │
│ 📊 状态：招募中/已满员/已结束    │
│ 💰 费用：免费/AA制/请客          │
├─────────────────────────────────┤
│     [重置]        [应用筛选]      │
└─────────────────────────────────┘
```

### 4.2 Tab 2: 消息 (Connect)

**页面结构**：
```
┌─────────────────────────────────┐
│ 🔔 系统通知                     │
├─────────────────────────────────┤
│ • 张三申请加入你的火锅局        │
│ • 你被标记为"未到场"[我到场了]  │ ← 申诉按钮
│ • 明天8点的聚餐别忘了           │
├─────────────────────────────────┤
│ 💬 群聊列表                     │
├─────────────────────────────────┤
│ 🍲 周五火锅局 (4/4人)           │
│ 🏃 夜跑小分队 (3/5人)           │
└─────────────────────────────────┘
```

### 4.3 Tab 3: 我 (Me)

**页面结构**：
```
┌─────────────────────────────────┐
│ 👤 昵称                         │
│ ⭐⭐⭐ 非常靠谱 (100%)           │
├─────────────────────────────────┤
│ 📊 统计                         │
│ 组织 12 场 | 参与 28 场         │
│ 收到 0 次差评                   │
├─────────────────────────────────┤
│ 👑 Pro会员                      │ ← 未订阅时显示开通入口
│ 📝 个人资料                     │
│ ⚙️ 设置                         │
│ 📋 我的争议记录                 │ ← 仅自己可见
└─────────────────────────────────┘
```

---

## 5. 核心业务流程 (Business Flows)

### 5.0 流量与获客 (Growth Loop)

#### 场景 A：群接龙识别
**描述**：用户复制微信群杂乱文本 → 点击 App 内 [+] → AI 自动识别意图 → 生成标准活动卡片

**流程**：
```
用户在微信群看到：
"明天晚上7点观音桥吃火锅，谁来？张三+1，李四+1..."
    │
    ▼
复制文本 → 打开聚场 → 点击 [+]
    │
    ▼
┌─────────────────────────────────┐
│ 🤖 魔法输入框                   │
├─────────────────────────────────┤
│ 📝 手动填写                     │
│ 🎙️ 语音输入                     │
│ 📋 粘贴文本 (检测到剪贴板)      │
└─────────────────────────────────┘
    │
    ▼
AI 解析 → 自动填表 → 一键发布
```

#### 场景 B：分享卡片闭环
**描述**：活动创建成功 → 弹出"分享图生成器" → 生成带"缺X人/倒计时"的精美图片 → 分享回微信群

**分享卡片设计**：
```
┌─────────────────────────────────┐
│ 🍲 周五火锅局                   │
│ 📍 观音桥 · 19:00              │
│ 👥 还缺 2 人                    │
│ ⏰ 距离开始还有 2 天 3 小时      │
├─────────────────────────────────┤
│ 扫码或搜索"聚场"小程序加入       │
│ [二维码]                        │
└─────────────────────────────────┘
```

#### 场景 C：扫码落地
**描述**：扫描线下码/识别群分享码 → 不进首页 → 根据 scene 参数直接打开活动详情或附近聚合页

**落地页逻辑**：
```
扫码进入
    │
    ├── scene=activity_123 → 直接打开活动详情
    ├── scene=location_lat_lng → 打开该位置的附近活动聚合页
    └── scene=invite_user_456 → 打开该用户的活动列表
```

### 5.1 创建活动 (FAB 入口)

```
用户点击底部 FAB [+]
    │
    ▼
┌─────────────────────────────────┐
│ 🤖 魔法输入框 (剩余2次)         │
├─────────────────────────────────┤
│ 📝 手动填写                     │
│ 🎙️ 语音输入                     │
│ 📋 粘贴文本 (检测到剪贴板)      │
└─────────────────────────────────┘
    │
    ▼ (AI创建)
输入："周五观音桥吃火锅，3人，AA"
或粘贴："明天晚上7点观音桥吃火锅，谁来？张三+1..."
    │
    ▼
调用 API (/ai/parse) → 跳转表单（已预填）
    │
    ▼
┌─────────────────────────────────┐
│ 确认活动信息                    │
├─────────────────────────────────┤
│ 标题：周五火锅局                │
│ 时间：周五 19:00                │
│ 地点：观音桥xxx                 │
│ 人数：4人                       │
│ 费用：AA制                      │
│ 🔒 ☐ 模糊地理位置               │
├─────────────────────────────────┤
│ 💡 推广选项                     │
│ ☐ 🚀 强力召唤 (+¥3)            │
│ ☐ 👑 黄金置顶 (+¥5)            │
├─────────────────────────────────┤
│ [免费发布]  [付费发布]          │
└─────────────────────────────────┘
```

### 5.2 报名流程

**普通报名**：
```
点击 [报名]
    │
    ▼
校验靠谱度门槛
    │
    ├── 通过 → 即时加入/等待审批
    │
    └── 不通过 → 提示"靠谱度不足"
```

**热门活动 Upsell**：
```
┌─────────────────────────────────┐
│ 🔥 热门活动 - 已有8人申请       │
├─────────────────────────────────┤
│ [普通申请]  [⚡优先申请 ¥2]     │
│                                 │
│ 优先申请将在审批列表中置顶显示   │
└─────────────────────────────────┘
```

### 5.3 履约确认

**发起人视角**：
```
活动结束后收到通知
    │
    ▼
┌─────────────────────────────────┐
│ 确认活动完成                    │
├─────────────────────────────────┤
│ ☑️ 张三 - 已到场                │
│ ☑️ 李四 - 已到场                │
│ ☐ 王五 - 未到场                 │
├─────────────────────────────────┤
│ ⚠️ 标记他人未到场将扣除你1%靠谱度│
├─────────────────────────────────┤
│ [全选到场]    [确认完成]        │
└─────────────────────────────────┘
```

**被标记者视角**：
```
收到推送通知
    │
    ▼
┌─────────────────────────────────┐
│ ⚠️ 你被标记为"未到场"           │
├─────────────────────────────────┤
│ 活动：周五火锅局                │
│ 发起人：张三                    │
│                                 │
│ 如果你确实到场了，请点击申诉：   │
│                                 │
│ [我到场了]                      │
│                                 │
│ 24小时内未申诉将自动生效        │
└─────────────────────────────────┘
```

### 5.4 差评反馈

**触发时机**：活动结束后弹窗

**流程**：
```
┌─────────────────────────────────┐
│ 本次活动体验如何？              │
├─────────────────────────────────┤
│   [👍 挺好的]    [👎 有问题]    │
└─────────────────────────────────┘
         │              │
         │              ▼
         │    ┌─────────────────────────────────┐
         │    │ 遇到了什么问题？                │
         │    ├─────────────────────────────────┤
         │    │ ☐ 有人迟到                     │
         │    │ ☐ 有人放鸽子                   │
         │    │ ☐ 态度不好                     │
         │    │ ☐ 与描述不符                   │
         │    │ ☐ 其他：[___________]          │
         │    │                                │
         │    │ 针对谁？                       │
         │    │ ○ 张三  ○ 李四  ○ 发起人       │
         │    │                                │
         │    │ [提交反馈]                     │
         │    └─────────────────────────────────┘
         │
         ▼
      关闭弹窗（默认好评，不记录）
```

---

## 6. AI 功能需求 (AI Requirements)

### 6.1 意图识别与自动填表
- 输入自然语言 → 解析 → 预填表单
- 消耗 1 次 AI 建局额度

### 6.2 风险评估
- 内容风险：敏感词检测
- 用户风险：靠谱度、差评记录、争议次数
- 场景风险：深夜、偏僻地点

### 6.3 深度风控报告（付费）
```
┌─────────────────────────────────┐
│ 🔮 张三的深度分析               │
├─────────────────────────────────┤
│ 📊 基础数据                     │
│ 靠谱度：85% | 参与：20场        │
│ 差评：2次 | 争议：1次           │
├─────────────────────────────────┤
│ 📈 履约时间线                   │
│ [图表：最近10场履约情况]        │
├─────────────────────────────────┤
│ 💬 差评详情                     │
│ • 12/01 火锅局：迟到30分钟      │
│ • 11/15 剧本杀：态度不好        │
├─────────────────────────────────┤
│ 🤖 AI风险评估                   │
│ 综合风险：低                    │
│ 建议：可以通过申请              │
└─────────────────────────────────┘
```

---

## 7. 技术兜底 (Technical Foundations)

### 7.1 日志记录

**必须记录的操作**：
- `Fulfillment_Action`：履约确认操作
- `Dispute_Action`：申诉操作
- `Payment_Action`：支付操作
- `AI_Usage`：AI调用记录

**日志字段**：
```typescript
interface ActionLog {
  userId: string;
  actionType: string;
  timestamp: Date;
  metadata: Record<string, any>;
  deviceId?: string;
  ipAddress?: string;
}
```

### 7.2 支付处理

**原子性保障**：
```
支付回调
    │
    ▼
开启事务
    │
    ├── 更新订单状态
    ├── 下发权益（Boost/Pin+/额度）
    ├── 记录日志
    │
    ▼
提交事务
```

**幂等性**：
- 使用 `out_trade_no` 作为幂等键
- 重复回调不重复下发权益

### 7.3 超时处理

**Cron Job**：
- 每小时检查活动结束超过24h且未确认的活动
- 自动标记全员履约成功
- 发送通知给发起人

### 7.4 懒注册

- 游客可浏览地图、查看活动详情
- 以下操作触发登录：创建活动、报名、查看群聊

---

## 8. 开发路线图 (Roadmap)

### Phase 1: 核心基础 (Week 1-2)
- 地图 + Pin渲染 + 筛选器
- AI创建活动 + 额度系统
- 用户系统 + 靠谱度

### Phase 2: 社交闭环 (Week 3-4)
- 群聊 + 活动提醒
- 履约确认 + 申诉机制
- 差评反馈系统

### Phase 3: 商业化 (Week 5-6)
- 微信支付集成
- Boost/Pin+/Fast Pass
- Pro会员订阅
- 全链路测试 + 提交审核

---

## 9. V9.2 核心变化总结

### 砍掉的功能
- ❌ **独立 AI 对话页**：从 Tab 2 完全移除
- ❌ **开放式聊天**：避免 Token 浪费和场景错位

### 新增的功能
- ✅ **微信群导流场景**：群接龙识别 + 分享卡片闭环
- ✅ **全能搜索框**：地图页顶部，支持自然语言
- ✅ **魔法输入框**：FAB 入口，支持语音/粘贴/AI 解析
- ✅ **重庆地形适配**：强制位置备注，适应 3D 地形
- ✅ **幽灵锚点优化**：复用 AI 解析流程，数据结构明确

### 架构优化
- 🔄 **3 Tab + 1 FAB**：地图/消息/我 + 中央创建按钮
- 🔄 **AI 融入业务**：搜索和创建流程中的工具，而非独立目的地
- 🔄 **流量闭环**：微信群 → 聚场 → 分享回群的完整循环

### 开发优先级
1. **Phase 1**：ShareCanvas 组件 + LaunchOptions 解析
2. **Phase 2**：全能搜索 + 魔法输入框
3. **Phase 3**：地形备注 + 幽灵锚点逻辑

---

## 10. 成功指标 (Success Metrics)

### 业务指标
- 活动成局率 > 60%
- 履约率 > 80%
- 7日留存 > 30%

### 商业指标
- Day 1 收入覆盖成本
- 付费转化率 > 5%
- Pro会员转化率 > 2%

### 风控指标
- 申诉率 < 10%
- 差评率 < 5%
- 争议解决率 > 90%
