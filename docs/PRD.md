# 聚场 (JuChang) 产品需求文档

> **版本**：v4.6 (Agent-First + 找搭子能力 + Welcome 页 + AI Ops 持久化)
> **更新日期**：2026-01-21
> **App 名称**：聚场 (JuChang)
> **产品定位**：Personal Social Agent (个人社交代理人)
> **核心 Slogan**：想怎么玩？跟小聚说说。
> **AI 角色名**：小聚 (XiaoJu)

---

## 0. 产品哲学：从工具到 Agent

### 0.0 我们不是工具，我们是 Agent

> **工具是被动的（人去操作它），Agent 是主动的（人与它协作，甚至它为人服务）。**

| 维度 | 传统工具 (SaaS) | 聚场 (Agent as a Service) |
|------|----------------|--------------------------|
| **交互模式** | 用户填表单、点按钮 | 用户说话，AI 理解并执行 |
| **界面生成** | 静态 UI，所有人看到一样的 | Generative UI，根据意图动态生成 |
| **服务对象** | 只服务"群主"（发起者） | 服务每一个人（发起者 + 参与者） |
| **用户关系** | 用完即走 | 记住你，下次更懂你 |
| **核心价值** | 效率工具 | 社交秘书 |

### 0.1 Chat-First：不是噱头，是架构

**为什么首页是对话，而不是列表/地图？**

传统 App 的首页是"货架"——你来挑。
聚场的首页是"对话"——你说，我帮你办。

这不是 UI 风格的选择，而是**产品定位的选择**：
- 货架模式 = 你是顾客，我是商城
- 对话模式 = 你是老板，我是秘书

**Chat-First 的三个核心优势**：

| 优势 | 说明 |
|------|------|
| **零门槛** | 不需要学习操作，会说话就会用 |
| **意图理解** | 用户不需要知道"该点哪个按钮"，AI 理解意图后自动执行 |
| **情绪价值** | 有人回应的感觉，比冷冰冰的界面温暖 |

### 0.2 Generative UI：界面是流动的

**传统 App**：界面是死的。无论谁来，看到的都是九宫格、列表、Banner。

**聚场**：界面是流动的。AI 根据你的意图，动态生成最合适的 Widget。

| 用户意图 | 生成的 UI |
|---------|----------|
| "明晚观音桥打麻将" | Widget_Draft（表单模式） |
| "附近有什么好玩的" | Widget_Explore（地图模式） |
| "这周五晚上不知道干嘛" | Widget_Explore + AI 推荐语 |
| "上次那个火锅局怎么样" | 文本回复 + 相关活动卡片 |

**这是聚场区别于所有竞品的杀手锏**：
- 对于发起者，它是高效的表单生成器
- 对于迷茫者，它是地图探索器
- 对于管理者，它是仪表盘

### 0.3 服务每一个人，不只是群主

**旧逻辑（工具）**：
```
用户打开 App → 看到卡片 → 报名 → 关闭
```
对于参与者来说，聚场只是一个"填坑的入口"。

**新逻辑（Agent）**：
```
用户不知道干嘛 → 问小聚 → 小聚推荐 → 报名 → 小聚提醒 → 结束后小聚询问反馈
```
小聚是每个人的社交秘书，不只是群主的工具。

**普通用户（非群主）为什么要和小聚聊天？**

| 场景 | 小聚的价值 |
|------|-----------|
| "这周五晚上不知道干嘛" | 理解情绪，推荐合适的活动 |
| "附近有什么好玩的" | 探索发现，降低决策成本 |
| "上次那个火锅局感觉怎么样" | 记住你的偏好，下次推荐更准 |
| "帮我算算人均多少钱" | 活动后的贴心服务 |

---

| 原则 | 说明 |
|------|------|
| **页面 (Page) 越少越好** | 保持沉浸，减少跳转 |
| **模态 (Modal/Sheet) 适度使用** | 解决中断，不打断主流程 |
| **流 (Stream) 是核心** | 对话不能断，状态要连贯 |

---

## 1. 产品定位与核心价值

### 1.1 三大核心优势

#### 🎯 响应感 —— 治愈"无人回应的焦虑"

| 旧世界（微信群） | 新世界（聚场） |
|-----------------|---------------|
| 发消息后死一般的寂静 | AI 秒回，0.5s 内开始响应 |
| 运气好有人回表情包 | 流式反馈：文字逐字显示，Widget 卡片逐步展开 |

#### 📍 秩序感 —— 把"混乱的流"变成"确定的卡片"

| 旧世界（微信群） | 新世界（聚场） |
|-----------------|---------------|
| 信息是流（Flow），瞬间被冲走 | 信息是卡片（Widget），24小时内雷打不动 |
| 想找刚才那个人？翻聊天记录 | 对话历史持久化，下次打开还在 |

#### ⚡ 零门槛 —— 不改变习惯，只提升效率

| 旧世界（填表单） | 新世界（AI 输入坞） |
|-----------------|-------------------|
| 选时间、选地点、填标题 | 在群里怎么说话，在这里就怎么说话 |
| 需要学习新操作 | 直接把群里的乱七八糟复制过来，自动变整齐 |

### 1.2 v3.4 架构：Chat-First + Generative UI + 小聚人格

| 版本 | 架构 | 问题 |
|------|------|------|
| v1.0 | 地图 + 表单 | 门槛高，用户要填表单，冷启动地图空白 |
| v2.0 | Card Feed | 信息密度低，不够直接 |
| v3.2 | Chat-First + Generative UI | 零门槛，像聊天一样组局 |
| v3.3 | + 小聚人格 + 竞品差异化 | 有灵魂，不是冷冰冰的系统 |
| **v3.4** | **+ 文案体系精修** | ✅ 统一品牌调性，强调 AI 执行力 |

**核心交互哲学**：
1. **首页即对话**：小程序打开不再是地图，而是一个无限滚动的 Chat View
2. **功能即气泡**：所有功能都封装在对话流的 Widgets 中
3. **去 Tabbar 化**：底部取消导航栏，改为悬浮的 AI Dock
4. **Generative UI**：AI 根据意图动态生成最合适的 Widget 类型

---

### 1.2 核心业务流程 (The Business Flows)

#### 1.2.1 [Flow] 找搭子 (Partner Matching) - 核心痛点攻坚

> **痛点 vs 解法**
> | 旧世界（微信群/朋友圈） | 新世界（聚场 AI Agent） | 业务价值 |
> |-------------------------|-------------------------|----------|
> | 喊话即消失：消息被淹没，有效期短 | 意向池化：需求转为 Struct 存入数据库，24h 有效 | 需求不丢失 |
> | 被动等待：能否成局看缘分，效率低 | 主动撮合：AI 24小时扫描匹配，精准推送 | 效率提升 10x |
> | 隐私顾虑：不想公开微信号给陌生人 | 虚拟中介：确认匹配意向后才交换联系方式 | 安全感提升 |

**业务剧本**：

1.  **表达 (Express)**
    - 用户："想找人周末剧本杀，不要太硬核的。"
    - AI："收到。有几个细节确认下：1. 具体是周六还是周日？2. 想要几个人？" (Slot Filling via CoT)
    - 用户："周六 afternoon，4-6人吧。"
    - AI："OK，已为你生成[剧本杀·找搭子意向卡片]。系统将在后台持续寻找匹配，有合适的我会第一时间通知你。"

2.  **存储与检索 (Store & Search)**
    - 系统将需求写入 `partner_intents` 表，状态为 `active`。
    - 启动 `PartnerMatcher` 定时任务，扫描活跃意向。
    - 发现匹配：距离 3km 内、同为"剧本杀"类别、时间重叠、Tag 相似度 > 80%。

3.  **双向确认 (Handshake)**
    - AI (对 A 仅可见)："帮你找到一个搭子！也是周六想玩本，就在你附近 2km。查看匹配详情？"
    - AI (对 B 仅可见)："有位朋友也想周六剧本杀，我看你们偏好挺像，要不要认识下？"

4.  **成局 (The Deal)**
    - A 点击 [感兴趣]，系统记录状态。
    - B 点击 [感兴趣]，匹配达成 (Matched)。
    - AI："太好了！这是对方的微信/二维码，你们聊！" (交换联系方式)
    - (Future)：AI 直接创建一个新的 Group Chat。

**流程图**：

```mermaid
sequenceDiagram
    participant U as 用户 (Joiner)
    participant AI as 聚场AI
    participant DB as 意向池 (partner_intents)
    participant M as 匹配引擎 (Matcher)
    participant P as 潜在搭子 (Candidate)

    Note over U, AI: 1. 表达意向
    U->>AI: "想找人打球"
    AI->>U: 追问时间/地点 (CoT)
    U->>AI: 补充信息
    AI->>DB: 创建意向 (Status: Active)
    AI-->>U: 展示意向卡片 (Widget_Intent)
    
    Note over DB, M: 2. 异步匹配
    loop 24小时扫描
        M->>DB: 寻找最佳匹配 (Vector + Rules)
        DB-->>M: 发现 Candidate P
    end
    
    Note over M, P: 3. 双向确认
    M->>AI: 触发匹配通知
    AI->>U: 推送匹配请求 (Card)
    AI->>P: 推送匹配请求 (Card)
    
    par 并行确认
        U->>AI: 确认感兴趣
        P->>AI: 确认感兴趣
    end
    
    Note over AI, U: 4. 交换信息
    AI->>U: 发送 P 联系方式
    AI->>P: 发送 U 联系方式
    M->>DB: 标记意向 (Status: Matched)
```

#### 1.2.2 [Flow] 极速组局 (Activity Creation)

> **痛点 vs 解法**
> | 旧世界（APP 表单） | 新世界（AI Chat） | 业务价值 |
> |--------------------|-------------------|----------|
> | 填表单：标题、时间、地点一个个填 | 一句话生成：AI 自动从自然语言提取要素 | 降低门槛 |
> | 缺信息：不知道地点在哪 | 模糊补全：AI 根据上下文推荐合适地点 | 辅助决策 |
> | 改来改去：调整很麻烦 | 对话修改："把时间改成明天" | 自然交互 |

**业务剧本与关键交互 (Creator Journey)**：

| 步骤 | 用户行为 | 系统/界面响应 | ⚠️ 体验细节点 (Micro-Interactions) |
|------|----------|---------------|----------------------------------|
| **1. 触发** | 打开小程序 | 显示首页 Chat 流 + 欢迎卡片 | **Loading 骨架屏** (防止冷启动白屏) |
| **2. 输入** | 粘贴一段乱七八糟的群接龙 | 底部 AI Dock 弹起，输入框聚焦 | **键盘避让动画** (确保输入框不被遮挡) |
| **3. 思考** | 点击发送 | Chat 流底部出现"呼吸气泡" | **AI 思考动效** (三个跳点呼吸灯，安抚焦虑) |
| **4. 预览** | AI 返回 `Widget_Draft` | 显示地图预览 + 关键信息 | **地图选点页** (若 AI 选点不准，用户可点击纠正) |
| **5. 确认** | 点击 [确认发布] | 检查手机号绑定状态 | **半屏授权弹窗** (Auth Sheet，不生硬跳转) |
| **6. 引导** | 发布成功 | Chat 流出现 `Widget_Share` | **全屏分享引导** (箭头指向右上角，消除"然后呢") |
| **7. 闭环** | 转发到群 | 微信原生分享卡片 | **卡片文案优化** (确保标题够骚，图片不裂) |

**流程图**：

```mermaid
sequenceDiagram
    participant U as 用户 (Creator)
    participant UI as 小程序界面
    participant AI as 聚场AI
    participant W as 微信生态

    Note over U, UI: 1. 启动与输入
    U->>UI: 打开小程序
    UI-->>U: 骨架屏 -> 欢迎卡片
    U->>UI: 输入"明晚火锅"
    UI->>AI: 发送请求
    UI-->>U: 展示思考气泡 (Thinking Bubble)
    
    Note over AI: 2. 意图解析
    AI->>AI: Intent=Create, Entity=Hotpot
    AI-->>UI: 返回 Widget_Draft (含AI推荐地点)

    Note over U, W: 3. 用户决策
    alt 需要修改
        U->>UI: 点击 [调整位置]
        UI->>UI: 打开地图选点页
        U->>UI: 确认新坐标
    end
    
    U->>UI: 点击 [确认发布]
    opt 未登录
        UI->>UI: 弹出半屏登录 (Auth Sheet)
        U->>UI: 授权手机号
    end
    
    UI->>AI: 提交发布
    AI-->>UI: 返回 Widget_Share
    UI-->>U: 弹出分享引导遮罩
    U->>W: 转发到微信群
```

#### 1.2.3 [Flow] 参与者体验 (Participant Journey)

> **痛点 vs 解法**
> | 旧世界（群接龙） | 新世界（聚场 Widget） | 用户体验 |
> |------------------|-----------------------|----------|
> | 信息杂乱：要翻好几页聊天记录 | 结构化卡片：时间地点一目了然 | 清晰 |
> | 信任缺失：不知道谁发起的，靠谱吗 | 信任背书：精美地图、倒计时、已报名头像 | 专业 |
> | 报名繁琐：要复制粘贴+1 | 一键上车：点击按钮即完成报名 | 爽快 |

**业务剧本与关键交互 (Joiner Journey)**：

| 步骤 | 用户行为 | 系统/界面响应 | ⚠️ 体验细节点 |
|------|----------|---------------|---------------|
| **1. 触达** | 在群里点击卡片 | 单页模式启动小程序 | **全局 Loading** (数据加载时的反馈) |
| **2. 决策** | 查看活动详情 | 显示活动邀请函详情页 | **法务条款入口** (点击报名时需同意) |
| **3. 行动** | 点击 [🙋‍♂️ 报名] | 检查手机号 → 成功报名 | **报名成功反馈动画** (撒花/震动，情绪价值) |
| **4. 连接** | 报名后去哪？ | 自动跳转到活动群聊 | **群聊空状态引导** (提示"打个招呼吧") |
| **5. 留存** | 想看看别的 | 点击左上角 [返回] | **首页回流兜底** (单页模式下重定向到首页) |

**流程图**：

```mermaid
sequenceDiagram
    participant U as 用户 (Joiner)
    participant UI as 小程序 (单页模式)
    participant API as 后端服务

    Note over U, UI: 1. 从分享卡片进入
    U->>UI: 点击群卡片
    UI->>API: 获取活动详情
    UI-->>U: 展示沉浸式详情页 (地图背景)

    Note over U, API: 2. 报名决策
    U->>UI: 点击 [报名]
    opt 未授权
        UI->>U: 弹出隐私协议 & 手机号授权
    end
    UI->>API: 提交报名
    API-->>UI: 成功
    UI-->>U: 播放撒花动画 -> 跳转群聊页
    
    Note over U, UI: 3. 社交沉淀
    U->>UI: 发送"我上车了！"
    UI->>API: 广播消息
```

---

#### 1.2.4 [Flow] 智能探索 (Smart Exploration)

> **痛点 vs 解法**
> | 旧世界（APP 列表页） | 新世界（AI 意图检索） | 体验提升 |
> |----------------------|-----------------------|----------|
> | 机械筛选：自己选区域、类型、排序 | 语义理解："想轻松点的局" -> 自动映射 Tags | 懂你 |
> | 列表枯燥：一张张图看过去 | 地图沉浸：可以展开的全屏地图，拖动即搜 | 直观 |

**业务剧本与关键交互**：

| 步骤 | 用户行为 | 系统/界面响应 | ⚠️ 体验细节点 |
|------|----------|---------------|---------------|
| **1. 提问** | "附近有啥好玩的" | AI 识别意图 `intent: explore` | **Thinking Bubble** |
| **2. 预览** | 等待 1s | AI 返回 `Widget_Explore` (带静态地图预览) | **多点 Marker** (地图上显示多个活动点) |
| **3. 沉浸** | 点击卡片或 [展开] | 展开为全屏地图模式 (Bottom Sheet 交互) | **动画过渡** (从气泡平滑展开全屏) |
| **4. 交互** | 拖动地图 / 切换 Tag | 即时刷新可视区域内的活动 | **动态加载** (无需手动刷新) |
| **5. 详情** | 点击地图 Pin | 底部弹出简略信息卡片 | **轻触反馈** |
| **6. 决策** | 点击卡片 | 跳转活动详情页 | - |

**全屏地图模式结构 (Immersive Map)**：

```
┌─────────────────────────────────────────────────────────┐
│  [←]              探索附近              [筛选]          │
├─────────────────────────────────────────────────────────┤
│  [全部] [美食] [运动] [桌游] [娱乐]                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                    Full Screen Map                      │
│         📍          📍                                  │
│                📍                                       │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────┐   │
│  │ ═══════════════════════════════════════════════ │   │
│  │ 🍲 观音桥火锅局 · 500m · 今晚 19:00         [>] │   │
│  │ 🎴 麻将局·3缺1 · 800m · 明天 14:00          [>] │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

---

### 1.3 竞品分析与差异化定位

> **这不是竞争，这是错位打击。**

#### 1.3.1 市场格局：粗门 vs 聚场

粗门（CuMen）是这个赛道里的"重装坦克"，走的是典型的 **"公域流量 + 商业化俱乐部 + 强运营"** 的 B2C/B2B2C 路线。他们的界面像是一个热闹的活动电商平台（像美团/大众点评的活动版）。

**如果我们跟他们硬碰硬（去抢俱乐部、搞大活动、拼流量分发），我们必死无疑。**

但好消息是：我们的 **Chat-First + Gen UI 架构**，刚好站在了他们的反面。

#### 1.3.2 本质模型的差异：商城 vs. 秘书

| 维度 | 粗门 (The Mall) | 聚场 (The Agent) |
|------|-----------------|------------------|
| **核心定义** | 活动电商平台 (Marketplace) | AI 组局效能工具 (Utility) |
| **发起人是谁** | B端 / Big C (俱乐部主理人、商家、职业领队) | Small C (普通群主、你、你的朋友、热心群友) |
| **为了什么** | 赚钱 / 搞流量 / 卖票 | 省事 / 怕冷场 / 攒个局 |
| **流量逻辑** | 公域分发 (算法推荐热门活动，像刷抖音) | 私域流转 (在微信群里点对点传播，像发红包) |
| **操作成本** | 极高 (填表、传海报、写文案、设置票种) | 极低 (给 AI 发一句话) |

**结论**：
- **粗门是给卖铲子的人用的**
- **聚场是给想挖坑种树的普通人用的**

#### 1.3.3 用户痛点 = 我们的机会点

很多用户不喜欢粗门，痛点通常集中在以下几点：

#### 痛点 A：商业味太浓，缺乏人情味

| 粗门现状 | 聚场解法 |
|----------|----------|
| 进去全是卖票的（9.9元/99元），全是专业的宣传海报 | **Soft Tech**：界面干净、没有广告、没有推销 |
| 用户感觉自己是"韭菜"，而不是"朋友" | 用户感觉这是"我和朋友的局"，是 AA 制的、平等的 |

#### 痛点 B：圈子固化，新人门槛高

| 粗门现状 | 聚场解法 |
|----------|----------|
| 需要加入某个 Club，里面有等级、有熟人圈子 | **一次性成局**：不强制加圈子 |
| 社恐进去很尴尬 | 基于当下的活动群（Lite Chat），活动结束就解散（或归档），没有社交压力 |

#### 痛点 C：组个小局太重了

| 粗门现状 | 聚场解法 |
|----------|----------|
| 我就想约 3 个朋友吃个火锅，还要去粗门建个活动、审核、发布？疯了吗？ | **一句话成局**：这就是 Chat-First 的绝对统治区 |
| 对于"高频、低客单价、熟人/半熟人"的局，粗门是大炮打蚊子 | 聚场是精准手术刀 |

#### 1.3.4 场景的绝对隔离 (Scenario Split)

这是我们和粗门的楚河汉界：

| 场景 | 谁占优势 | 为什么？ |
|------|----------|----------|
| 商业活动 (百人徒步、飞盘局、收费教学) | 🔴 **粗门 胜** | 需要票务系统、核销、公域流量招募陌生人 |
| 兴趣社群 (每周固定的羽毛球俱乐部) | 🔴 **粗门 胜** | 需要会员管理、积分体系、排行榜 |
| 朋友聚餐 (火锅、烧烤、家宴) | 🟢 **聚场 胜** | 粗门做不了。太重了，用户不会为了吃饭去发个商业活动 |
| 临时起意 (今晚去哪喝一杯？谁有空？) | 🟢 **聚场 胜** | 唯快不破。Chat-First 3秒生成，直接甩群里摇人 |
| 半熟人拼车/拼单 (剧本杀缺1、拼车去机场) | 🟢 **聚场 胜** | 信任感。基于群聊的信任背书，加上 Widget 的清晰展示 |
| 不知道去哪 (探索周边) | 🟢 **聚场 胜** | AI 意图识别。粗门要你自己在列表里搜，聚场是直接告诉你"附近有啥" |

**差异化总结**：
- **粗门垄断了头部 20% 的"严肃/商业活动"**
- **聚场要吃掉长尾 80% 的"生活/社交活动"**

#### 1.3.5 杀手锏：Gen UI vs. Static UI

**粗门的 UI** 是典型的 Web 2.0 货架式 UI：
- 复杂的 Tabbar（首页、圈子、发布、消息、我的）
- 密密麻麻的 Banner 和瀑布流
- 如果你想发布活动，你需要适应它的表单

**聚场的 UI** 是 Web 3.0 / Agent UI：
- **Chat-First**：只有一个对话框
- **Generative**：如果你想发布活动，系统适应你的语言
- **活动邀请函**：生成的不是一个"商品详情页"，而是一张"社交邀请函"

> 这种体验上的降维打击，会让用惯了粗门的用户感到震惊：**"原来组个局可以这么简单？"**

#### 1.3.6 战略定位：不做平台，做工具

**不要试图模仿粗门去做**：
- ❌ 俱乐部入驻机制
- ❌ 主理人激励计划（那个复杂的贡献值/奖金池）
- ❌ 年度盛典/排行榜

**我们要极致地做**：
- ✅ **微信群的外挂**：我们是寄生在微信群里的 AI，而不是想把人拉到 App 里的平台
- ✅ **发起人的面子**：让那个只会说"来吃饭"的群主，变成能发出精美邀请函的"主理人"
- ✅ **AI 的智能**：粗门没有 AI，他们靠运营堆砌内容。我们靠 AI 整理内容

#### 1.3.7 一句话差异化

如果投资人或用户问你："你们和粗门有什么区别？"

你的回答：

> **"粗门是给俱乐部卖票的电商平台；聚场是你的 AI 活动助理。"**
>
> **"你想去参加百人徒步，去粗门。你想约几个朋友吃火锅、打麻将、拼个车，用聚场。"**

#### 1.3.8 名字的意义

现在回看"聚场"这个名字：

> **我们守住的是生活里最真实的那些"小聚"，而那里才是 99% 的流量所在。**

---

## 2. 商业模式 (MVP)

### 2.1 核心策略：全免费

**MVP 阶段目标**：验证产品价值，积累用户数据

| 功能 | 额度 | 说明 |
|------|------|------|
| AI 创建活动 | 3次/天 | 防止滥用，满足正常需求 |
| AI 探索附近 | 5次/天 | 探索场景额度 |
| 报名参与 | ✅ 无限 | 核心功能 |
| 群聊沟通 | ✅ 无限 | 核心功能 |
| 分享活动 | ✅ 无限 | 增长引擎 |

### 2.2 MVP 砍掉的功能

| 功能 | 砍掉原因 |
|------|----------|
| 付费推广 | MVP 阶段验证核心价值 |
| 会员订阅 | 用户量不足 |
| 幽灵锚点 | 运营成本高 |
| 靠谱度系统 | 复杂度高 |
| 图片上传 | 开发成本高 |
| 俱乐部入驻 | 不做平台，做工具（见 1.3.6 战略定位） |
| 主理人激励计划 | 不做平台，做工具（见 1.3.6 战略定位） |

---

## 3. 核心功能：Chat-First 首页

### 3.1 首页三层结构

```
┌─────────────────────────────────────────────────────────┐
│  [≡]              聚场              [⋮]                │  ← Custom Navbar
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 🤖 晚上好，渣渣辉                               │   │  ← Widget Dashboard
│  │                                                 │   │
│  │ 📅 今日待参加                                   │   │
│  │ ┌─────────────────────────────────────────┐    │   │
│  │ │ 🍲 观音桥火锅局 · 今晚 19:00            │    │   │
│  │ └─────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│                    Chat Stream                          │  ← 对话流
│                                                         │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────┐   │
│  │ 粘贴群聊天记录，或直接告诉我怎么玩... [📋] [🎤]│   │  ← AI Dock
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 3.2 Custom Navbar

| 位置 | 元素 | 功能 |
|------|------|------|
| 左侧 | Menu 图标 (≡) | 跳转个人中心 |
| 中间 | 品牌词"聚场" | - |
| 右侧 | More 图标 (⋮) | 显示下拉菜单 |

**下拉菜单 (Dropmenu)**：
- [消息中心] → 跳转消息列表
- [新对话] → 清空对话历史

### 3.3 Widget 类型 (Generative UI)

| Widget | 说明 | 触发时机 |
|--------|------|----------|
| Widget_Dashboard | 进场欢迎卡片 | 首次进入/新对话 |
| Widget_Draft | 意图解析卡片 | AI 识别为"创建意图" |
| Widget_Share | 创建成功卡片 | 活动发布成功 |
| **Widget_Explore** | **探索卡片** | **AI 识别为"探索意图"** |
| Widget_Error | 错误提示卡片 | AI 解析失败 |

### 3.4 AI 意图分类 (Intent Classification)

| 用户输入 | 意图类型 | 返回 Widget |
|---------|---------|-------------|
| "明晚观音桥打麻将，3缺1" | 明确创建 | Widget_Draft |
| "周六下午踢球，解放碑" | 明确创建 | Widget_Draft |
| "观音桥附近有什么好玩的活动" | 模糊探索 | Widget_Explore |
| "推荐一下附近的局" | 模糊探索 | Widget_Explore |
| "今天天气怎么样" | 无法识别 | 文本消息（引导） |

### 3.5 进场欢迎卡片 (Widget_Dashboard & Entry Experience)

> **设计灵感**：参考蚂蚁阿福的 Welcome 界面，将「健康档案」概念映射为「社交档案」，让用户一进来就看到自己的社交成就，有归属感。

#### 3.5.1 Welcome 页布局

```
┌─────────────────────────────────────────────────────────┐
│  Hi～✨ [nickname]，今天想约啥？                         │  ← 动态问候语 (3.5.2)
│                                                         │
│  ┌─ 我的社交档案 ──────────────────────────────── ∨ ┐  │
│  │                                                   │  │
│  │  🎯 参与 12 场        📍 发起 3 场                │  │  ← 社交数据
│  │                                                   │  │
│  │  ✨ 完善偏好，获得更精准推荐                       │  │  ← 引导文案
│  │                                                   │  │
│  │                    [去完善 →]                      │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │  ← 快捷入口
│  │  # 周末附近有什么活动？                      →  │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

#### 3.5.2 动态问候语

> **原则**：根据时间动态变化，且必须包含"引导输入"的暗示，强调 AI 的执行力。

| 时间 | 问候语 |
|------|--------|
| 周末 | "周末愉快～✨ [昵称]，今天想约啥？" |
| 工作日晚 | "晚上好～✨ [昵称]，今晚有什么安排？" |
| 深夜 | "这么晚还没睡？✨ 想约宵夜还是找人聊天？" |

#### 3.5.3 Dashboard 四态设计

Widget_Dashboard 根据用户状态显示不同内容，**确保对话永远不会"死"在空白状态**：

| 状态 | 显示内容 | 用户行动 |
|------|---------|---------|
| **首次进入** | 问候语 + 社交档案卡片 + 快捷入口 | 完善偏好/点击快捷入口 |
| **有待参加活动** | 问候语 + 社交档案卡片(收起) + 活动列表（最多 3 个） | 点击查看活动详情 |
| **有未发布草稿** | 问候语 + 草稿提醒卡片 + 快捷入口 | 继续编辑草稿 |
| **空状态** | 问候语 + 引导文案 + 热门 Prompt | 点击 Prompt 直接填充输入框 |

**社交档案卡片数据来源**：

| 字段 | 来源 | 说明 |
|------|------|------|
| 参与活动数 | `users.participationCount` | 累计参与的活动数量 |
| 发起活动数 | `users.activitiesCreatedCount` | 累计发起的活动数量 |
| 偏好完善度 | `users.workingMemory` | 根据 preferences 数组长度计算 |

**偏好设置页 (PreferencePage)**：

路径：`subpackages/setting/preference/index`

```
┌─────────────────────────────────────────────────────────┐
│  [←]              我的偏好                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🎯 活动类型                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [火锅] [运动] [桌游] [KTV] [户外] [+更多]       │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ⏰ 时间偏好                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [工作日晚] [周末白天] [周末晚上] [随时都行]      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  📍 常去地点                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [观音桥] [解放碑] [南坪] [+添加]                 │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  👥 社交偏好                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [小规模(≤4人)] [中等(5-8人)] [大型(>8人)]       │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│                    [保存偏好]                           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**偏好数据存储**：保存到 `users.workingMemory` 字段，格式遵循 `EnhancedUserProfile`

**空状态设计（冷启动核心）**：
```
┌─────────────────────────────────────────────────────────┐
│  💬                                                     │
│  最近没局？有些朋友可能在等你开口。                      │
│                                                         │
│  试试这样说：                                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │ "今晚观音桥打麻将，3缺1"                        │   │
│  │ "周末解放碑吃火锅"                              │   │
│  │ "明天下午踢球，差2人"                           │   │
│  │ "周六晚上 KTV，有人吗"                          │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

点击任意 Prompt → 自动填充到 AI Dock 输入框 → 引导用户创建活动

> **Agent 设计原则**：永远不让对话死掉，永远引导用户下一步行动。

#### 3.5.4 输入框设计哲学 (Agent-First)

> **弱化"发布"按钮，强化"输入框"** —— 不要让用户觉得"我没有活动要发就不能用这个 App"。

| 旧设计 (工具思维) | 新设计 (Agent 思维) |
|------------------|-------------------|
| "粘贴群聊天记录..." | "想找点乐子？还是想约人？跟我说说。" |
| 暗示：你要组局 | 暗示：我是你的助理 |

**输入框占位符的心理暗示**：
- ❌ "粘贴群聊天记录，或直接告诉我怎么玩..." → 暗示用户必须有明确目的
- ✅ "想找点乐子？还是想约人？跟我说说。" → 暗示小聚是你的社交秘书

**热门 Prompt 引导**：
当用户不知道说什么时，显示可点击的快捷入口：
- "附近有什么好玩的？"
- "这周末想放松一下"
- "帮我组个火锅局"

---

## 8. 个人中心 (Profile Page)

### 8.1 页面风格

**Inset Grouped List**：浅灰背景 + 白色圆角卡片组

### 8.2 页面结构

```
┌─────────────────────────────────────────────────────────┐
│  [←]              个人中心                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  [头像]  渣渣辉                                  │   │  ← Header
│  │          一起来组局吧                            │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  [📝] 我发布的                              [>] │   │  ← Group 1
│  │  [🎯] 我参与的                              [>] │   │
│  │  [📦] 历史归档                              [>] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  [📱] 手机绑定                        已认证    │   │  ← Group 2
│  │  [🔒] 隐私设置                              [>] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  [ℹ️] 关于聚场                              [>] │   │  ← Group 3
│  │  [💬] 意见反馈                              [>] │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 9. 消息中心 (Message Center)

### 9.1 功能

- 显示所有参与的活动群聊列表
- 显示活动标题、最后一条消息、未读数量
- 点击跳转到活动群聊页面

### 9.2 群聊状态

| 状态 | 显示 |
|------|------|
| 活跃 | 正常显示 |
| 已归档 | 显示"已归档"标识 |

---

## 10. 活动群聊 (Lite Chat)

### 10.1 基本规则

- 活动创建后立即开启群聊
- 仅支持文字消息
- 活动开始后 24 小时自动归档（只读）

### 10.2 轮询机制

- 前台：每 5-10 秒轮询新消息
- 后台：停止轮询
- 回到前台：立即请求一次 + 恢复轮询

---

## 11. 延迟验证

### 11.1 游客权限

| 操作 | 是否需要登录 |
|------|-------------|
| 浏览对话 | ❌ |
| 查看活动详情 | ❌ |
| 尝试 AI 解析 | ❌ |
| 探索附近活动 | ❌ |
| 发布活动 | ✅ 需绑定手机号 |
| 报名活动 | ✅ 需绑定手机号 |

### 11.2 手机号绑定

使用微信原生能力：
```html
<button open-type="getPhoneNumber" bindgetphonenumber="onGetPhoneNumber">
  绑定手机号
</button>
```

---

## 12. 活动管理

### 12.1 发起人操作

| 时机 | 可用操作 |
|------|----------|
| 活动未开始 | 删除活动 |
| 活动开始后 | 确认成局 / 取消活动 |

### 12.2 状态流转

```
draft → active → completed
              → cancelled
```

---

## 13. 视觉设计：Soft Tech (柔和科技)

### 13.1 设计灵感

**蚂蚁阿福 (Ant Ah Fu)** 的疗愈科技风格：清爽、柔和、高信任感

### 13.2 配色方案

| 用途 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 页面背景 | #F5F7FA | #0F172A |
| 卡片背景 | #FFFFFF | #1E293B |
| 主文字 | #1F2937 | #F1F5F9 |
| 次文字 | #6B7280 | #94A3B8 |
| 主色 (矢车菊蓝) | #5B75FB | #6380FF |
| 背景渐变顶部 | #E6EFFF | #1E1B4B |
| 辅助色 - 淡蓝 | #93C5FD | - |
| 辅助色 - 淡紫 | #C4B5FD | - |
| 辅助色 - 薄荷青 | #6EE7B7 | - |

### 13.3 卡片风格 (Soft Card)

- 纯白背景（深色模式：深板岩灰）
- 大圆角 32rpx
- 柔和阴影（深色模式：淡边框代替）

### 13.4 深色模式

- 从 Day 1 支持
- 使用语义化 CSS 变量
- 深色背景使用 Slate/Navy 色板，非纯黑

---

## 14. 语气规范 (Tone of Voice) 🗣️

### 14.1 核心原则

> **不要让 UI 的高级感变成"距离感"**
> 虽然我们用了精美的活动邀请函、Generative UI，但文案和交互必须接地气。

#### AI 角色设定

| 属性 | 设定 |
|------|------|
| **名字** | 小聚 (XiaoJu) |
| **定位** | 用户的 AI 活动助理，不是冷冰冰的系统 |
| **称呼用户** | 根据场景灵活使用（如"主理人"、"[昵称]"） |
| **自我介绍** | "Hi，我是小聚。想怎么玩？跟我说说，我来安排。" |
| **语气** | 温暖、接地气、像朋友一样，但强调执行力 |

> **"聚场"是空间，"小聚"是服务者** —— 这解决了"平台感太重"的问题。

### 14.2 小聚回复示例 (v3.4 优化)

| ❌ 反例（太装逼） | ✅ 正例（小聚风格） |
|------------------|------------------|
| "已为您构建全息活动契约，请确认地理围栏坐标。" | "帮你把局组好了！就在观音桥，离地铁口 200 米，把这张卡片发群里吧。" |
| "正在解析您的意图向量..." | "收到，小聚正在整理你的安排..." |
| "活动实体已成功持久化至数据库。" | "卡片做好了！看看这样安排行不行？" |
| "检测到地理位置偏移，建议重新校准。" | "这个地址好像有点远，要不要换一个？" |

### 14.3 按钮文案

| ❌ 反例 | ✅ 正例 |
|--------|--------|
| 确认提交 | 确认发布 |
| 执行分享 | 分享到群 |
| 调整地理坐标 | 调整位置 |
| 查看详细信息 | 查看详情 |
| 展开地图视图 | 展开地图 |

### 14.4 错误提示

| ❌ 反例 | ✅ 正例 |
|--------|--------|
| "解析失败，请检查输入格式。" | "抱歉，我没理解你的意思，试试换个说法？" |
| "网络请求超时，错误码 504。" | "网络有点慢，再试一次？" |
| "今日配额已耗尽。" | "今天的 AI 额度用完了，明天再来吧～" |
| "用户认证失败。" | "需要先绑定手机号才能继续哦" |

### 14.5 空状态文案 (v3.4 优化)

| 场景 | 文案 |
|------|------|
| 无待参加活动 | "最近没局？有些朋友可能在等你开口。" |
| 探索无结果 | "附近暂时没有活动，要不你来发起第一个？" |
| 消息中心为空 | "还没有群聊消息，发布活动后就有了" |
| 输入框占位符 | "粘贴群聊天记录，或直接告诉我怎么玩..." |

### 14.6 AI 思考与反馈文案 (v3.4 新增)

| 场景 | 文案 |
|------|------|
| AI 正在生成 | "收到，小聚正在整理你的安排..." |
| AI 生成完毕 | "卡片做好了！看看这样安排行不行？" |
| 发布成功 | "搞定！活动已发布，快分享给朋友吧。" |
| 额度用完 | "今天的 AI 额度用完了，明天再来吧～" |
| 网络错误 | "网络有点慢，再试一次？" |
| 解析失败 | "抱歉，我没理解你的意思，试试换个说法？" |

### 14.7 分享卡片文案 (v3.4 新增)

| 元素 | 文案 |
|------|------|
| 标题 | (AI 生成的活动标题，如：🔥 观音桥老火锅，3缺1) |
| 副标题 (App 来源) | "聚场AI - 想怎么玩？跟小聚说说" |
| 默认分享标题 | "聚场 - 你的 AI 活动助理" |

---

## 15. 页面结构

### 15.1 完整页面清单 (13 页)

| 页面 | 路径 | 类型 | 说明 |
|-----|------|------|------|
| 首页 | `pages/home/index` | 主包 | Chat-First 对话流 |
| 个人中心 | `pages/profile/index` | 主包 | Inset Grouped List |
| 消息中心 | `pages/message/index` | 主包 | 群聊列表 |
| 活动群聊 | `pages/chat/index` | 主包 | Lite Chat |
| 活动详情 | `subpackages/activity/detail/index` | 分包 | 活动邀请函详情 |
| 活动确认 | `subpackages/activity/confirm/index` | 分包 | 发布前确认 |
| 活动列表 | `subpackages/activity/list/index` | 分包 | 我发布的/我参与的/历史归档 |
| **地图选点** | `subpackages/activity/map-picker/index` | 分包 | 中心固定 Pin + 逆地址解析 |
| **沉浸式地图** | `subpackages/activity/explore/index` | 分包 | Generative UI 展开 |
| **法务页** | `subpackages/legal/index` | 分包 | 用户协议 + 隐私政策 (审核必备) |

### 15.2 中间态组件清单 (非页面)

| 组件 | 路径 | 触发场景 |
|------|------|----------|
| **auth-sheet** | `components/auth-sheet/` | 需要手机号绑定时 |
| **share-guide** | `components/share-guide/` | 活动发布成功后 |
| **activity-preview-sheet** | `components/activity-preview-sheet/` | 地图页点击 Pin |
| **thinking-bubble** | `components/thinking-bubble/` | AI 思考中 |
| **widget-skeleton** | `components/widget-skeleton/` | Widget 加载中 |

### 15.3 典型用户路径

**发起者链路 (Creator Flow)**：
```
首页(1) → [AI 思考] → Widget_Draft → [地图选点(2)] → [确认发布] → Widget_Share → [分享引导] → 转发到群 ✅
```

**参与者链路 (Joiner Flow)**：
```
点击卡片(1) → 活动详情 → [报名] → [auth-sheet] → 报名成功 → 活动群聊(2) ✅
```

**探索场景**：
```
首页(1) → Widget_Explore → 沉浸式地图(2) → [activity-preview-sheet] → 活动详情(3) = 3 层 ✅
```

**个人中心**：
```
首页(1) → 个人中心(2) → 活动列表(3) → 活动详情(4) = 4 层 ✅
```

**分享卡片进入**：
```
分享卡片进入(1) → 返回 → 首页(1) = 1 层 ✅ (首页回流兜底)
```

---

## 16. 产品逻辑闭环

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   明确意图                        模糊探索              │
│   "明晚观音桥打麻将"              "观音桥有什么好玩的"   │
│         │                              │                │
│         ▼                              ▼                │
│   Widget_Draft                   Widget_Explore         │
│   (表单模式)                     (地图模式)             │
│         │                              │                │
│         ▼                              ▼                │
│   用户确认发布                   沉浸式地图页           │
│         │                              │                │
│         ▼                              ▼                │
│   Widget_Share                   发现感兴趣的活动       │
│   (卡片模式)                           │                │
│         │                              ▼                │
│         ▼                        活动详情页 → 报名      │
│   分享到微信群                                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**这就是 Generative UI 的核心价值**：根据用户意图，动态生成最合适的界面，而不是简单地返回文本或跳转页面。

---

## 17. 成功指标

> **拒绝虚荣指标**：不看"用户数"、"PV"、"分享次数"，只看能回答"担心的声音"的指标。

### 17.1 北极星指标：J2C 转化率

> **核心逻辑**：一个普通用户，最开始是 Joiner（参与者）。他点开了一张精美的邀请函，觉得"这卡片真酷"。当他下次自己想约饭时，如果能想起用聚场发一个局，他就完成了从 Joiner 到 Creator 的跃迁。**这是聚场最核心的增长引擎：体验即营销。**

```
J2C 转化率 = 先参局后组局的用户数 / 历史总参与者数
```

| J2C 转化率 | 含义 |
|-----------|------|
| < 1% | 单纯的工具，只有"群主阶级"在用，增长靠拓新 |
| 1% - 5% | **PMF 达标线**，普通群友开始尝试"篡位"当群主 |
| > 5% | 病毒式增长，产品在群裂变中自运转 |

### 17.2 核心业务指标

| 担心的声音 | 对应指标 | 达标线 | 计算方式 |
|-----------|---------|--------|---------|
| "怕没人觉得有用" | 对话→生成卡片转化率 | ≥ 5% | 发消息后生成 widget_draft 的比例 |
| "怕卡片不够吸引人" | 草稿→发布转化率 | ≥ 60% | AI 生成草稿后确认发布的比例 |
| "怕活动发了没人来" | 活动成局率 | ≥ 50% | `completed` / `active` |
| "怕只有群主用" | J2C 转化率 | ≥ 3% | 先参局后组局的用户占比 |
| "怕用完即走" | 周留存率 | ≥ 15% | 本周用过，下周又打开的用户占比 |
| "怕变成粗门" | 一次性群主占比 | ≥ 70% | 只创建过 1-3 次活动的用户占比 |

### 17.3 PMF 验证策略

> **特洛伊木马** —— 不要推销，要帮忙。
> 
> 在目标群里潜伏，看到有人喊"周末有人去玩吗？"，主动帮他生成一张邀请函：
> "@那个人 帮你做了个邀请函，发这个大家看得更清楚👇"

**观测"惊叹时刻" (Aha Moment)**：
- 有人问"这卡片怎么做的？" → 验证成功 50%
- 有人真的报名 + 群主觉得方便 → 验证成功 100%

**不看的虚荣指标**：
- ❌ 用户数 —— 100 个僵尸用户不如 10 个活跃群主
- ❌ 次日留存 —— 没人天天组局，周留存更合理
- ❌ 分享次数 —— 分享了不代表有人看/报名

### 17.4 Admin Dashboard

> **Solo Founder 版**：只看 3 个数，每周看一眼。

| 指标 | 含义 | 达标线 |
|------|------|--------|
| **本周成局数** | 真实跑通的活动数量 | ≥ 5 个/周 |
| **J2C 转化率** | 被卡片种草后自己去发卡片的人 | ≥ 3% |
| **分享→报名转化** | 分享出去后真的有人报名 | ≥ 10% |

**J2C 转化率 SQL**：
```sql
WITH Joiners AS (
  SELECT DISTINCT user_id, MIN(created_at) as first_join_date
  FROM participants WHERE status = 'joined'
  GROUP BY user_id
),
Creators AS (
  SELECT DISTINCT creator_id, MIN(created_at) as first_create_date
  FROM activities WHERE status != 'draft'
  GROUP BY creator_id
)
SELECT 
  COUNT(*) FILTER (WHERE c.first_create_date > j.first_join_date)::float 
  / COUNT(*)::float * 100 as j2c_rate
FROM Joiners j
LEFT JOIN Creators c ON j.user_id = c.creator_id;
```

### 17.5 技术指标

| 指标 | 目标 |
|------|------|
| AI 响应时间 | < 2s |
| 页面加载时间 | < 1s |
| 小程序包体积 | < 2MB |

---

## 18. 技术约束（AI 友好型实现）

- ❌ 不使用 `backdrop-filter: blur()` —— 低端安卓机性能杀手
- ❌ 不使用跨页面 Shared Element Transition —— 小程序难以实现
- ❌ 不自动读取剪贴板 —— 微信会强制弹窗，体验差
- ❌ 不在 scroll-view 中嵌入可交互 map —— 手势冲突
- ✅ 使用高透明度白色背景 + box-shadow 模拟层级感
- ✅ 使用静态 Mesh Gradient 图片做背景（性能最优）
- ✅ 用户主动点击粘贴按钮触发剪贴板读取
- ✅ Widget_Explore 使用静态地图图片，点击后展开全屏地图

---

## 19. 找搭子能力 (Partner Matching)

> **用户想参加某类活动但不想自己组局，Agent 自然识别意图并帮用户找搭子。**
> 
> **核心理念**：找搭子是 Agent 的自然能力，不是"模式切换"。用户不需要知道背后有什么机制，只需要像跟朋友聊天一样说"谁组我去"，小聚自动完成匹配。

### 19.1 核心场景

**用户说**："想吃火锅，谁组我就去"

**传统方案**：用户只能等别人发布活动，或者自己硬着头皮组局。

**Broker Mode**：小聚主动收集用户偏好，在后台匹配相似意向的用户，撮合成局。

### 19.2 核心流程

```
用户: "想吃火锅，谁组我就去"
  ↓
Agent 识别到找搭子意图，启动结构化追问
  ↓
用户: "1A 2A 3AD" (今晚/AA/不喝酒+没特殊要求)
  ↓
Agent 调用 createPartnerIntent
  ↓
系统匹配 → 创建 Match → Temp_Organizer 确认 → 转为 Activity
```

### 19.3 结构化追问 (Widget_AskPreference)

```
好的，帮你找火锅搭子！🍲 请确认：

1. ⏰ 时间？ A: 今晚  B: 明天  C: 周末
2. 💰 费用？ A: AA制  B: 有人请客也行
3. 🎯 要求？ A: 不喝酒  B: 安静点  C: 女生友好  D: 没有

回复：**1A 2A 3AD**
```

### 19.4 匹配规则

| 规则 | 说明 |
|------|------|
| 活动类型 | 完全匹配（火锅 ↔ 火锅） |
| 位置距离 | 3km 内 |
| Tag 冲突 | 无冲突（AA ↔ Treat 冲突，NoAlcohol ↔ Drinking 冲突） |
| 匹配分数 | ≥ 80% |

### 19.5 生命周期

**Intent 状态**：
```
active → matched (匹配成功)
       → expired (24h 自动过期)
       → cancelled (用户取消)
```

**Match 状态**：
```
pending → confirmed (Temp_Organizer 确认，转为 Activity)
        → expired (6h 无响应自动过期)
        → cancelled (任一方取消)
```

### 19.6 Temp_Organizer 机制

- **定义**：匹配成功后，最早创建意向的用户成为 Temp_Organizer
- **职责**：确认匹配、补充活动细节（地点、时间）、转为正式活动
- **超时**：6h 内未确认，Match 自动过期

### 19.7 与现有功能的关系

| 意图 | 触发词 | 响应 |
|------|--------|------|
| 创建 | 想/约/组/找人 | exploreNearby → createActivityDraft |
| 探索 | 附近/推荐/有什么 | Widget_Explore |
| **找搭子** | **谁组我就去/懒得组局/想参加** | **识别意图 → 结构化追问 → createPartnerIntent** |
| 查询 | 我的活动 | getMyActivities |

---

## 20. AI 运营能力

### 20.1 用户画像 (Working Memory)

小聚记住用户偏好，下次推荐更准：

| 维度 | 示例 |
|------|------|
| 活动类型 | 喜欢火锅、不喜欢 KTV |
| 时间偏好 | 偏好周末、晚上 |
| 地点偏好 | 常去观音桥、解放碑 |
| 社交偏好 | 喜欢小规模（4人以下） |

**技术实现**：
- 存储在 `users.workingMemory` 字段（JSON 格式）
- 通过 LLM 从对话历史中提取偏好
- 注入到 System Prompt 中个性化回复

### 20.2 内容审核

AI 检测活动内容风险：

| 检测项 | 说明 |
|--------|------|
| 敏感词 | 政治、色情、暴力等 |
| 联系方式泄露 | 手机号、微信号 |
| 风险评分 | 0-100 分，>70 需人工审核 |

### 20.3 异常检测

| 异常类型 | 触发条件 |
|---------|---------|
| 批量创建 | 24h 内创建 >10 个活动 |
| 频繁取消 | 7d 内取消 >5 次 |
| 异常报名 | 短时间内报名大量活动 |

---

## 21. Future Roadmap (Phase 2)

### 21.1 AI 海报生成 API

> **Phase 2: 视觉增长引擎** - 当需要破圈传播时上线

**问题**：Native Share Card 适合群聊快速分享，但朋友圈需要更有设计感的海报。

**解决方案**：提供 `POST /share/poster` API，供小程序和 Admin 调用，生成 AI 增强的朋友圈海报。

**用户流程**：
```
用户点击"生成海报" 
  → 显示"AI 正在绘制您的专属海报..."
  → 3-5 秒后返回海报图片
  → 用户保存到相册 / 发朋友圈
```

**核心卖点**：
- **每次都不一样**：AI 根据活动内容生成独特背景图
- **设计感拉满**：精美的活动邀请函视觉风格，支持毛玻璃、渐变边框等高级效果
- **一键保存**：直接生成图片，无需截图

**策略**：
- **Phase 1 (MVP)**：Native Share Card 解决"快"和"群聊"
- **Phase 2 (Growth)**：AI 海报 API 解决"美"和"朋友圈"

---

## 21.2 微信聊天工具模式 (Chat Tool Mode) ⭐ Phase 2 核心方向

> **用群聊替代推送** — 彻底解决微信订阅消息的限制问题

### 19.2.1 为什么这是核心方向

**现有通知策略的致命问题**：

| 问题 | 订阅消息的坑 |
|------|-------------|
| 授权门槛 | 用户要主动点「允许」，大部分人不点 |
| 次数限制 | 一次授权只能发一条，用完就没了 |
| 模板审核 | 内容受限，不能自定义 |
| 触达率低 | 用户关掉通知就彻底失联 |

**聊天工具模式的「群内系统消息」完全绕过这些限制**：
- ✅ 不需要用户授权
- ✅ 没有次数限制
- ✅ 所有群成员都能看到
- ✅ 微信官方样式，权威感强
- ✅ 每次报名都是一次免费的群内曝光

**核心洞察**：用户本来就在群里，通知就应该在群里发生，而不是跳出去发订阅消息。

### 19.2.2 功能概述

微信「聊天工具模式」是小程序与微信聊天深度结合的新能力，完美契合聚场的产品定位：**微信群的外挂**。

**核心能力**：
- 绑定群聊/单聊，获取 `opengid` / `group_openid`
- 选择群成员并获取身份标识
- 发送小程序卡片、提醒消息、文本、图片到聊天
- 动态消息：卡片辅标题实时更新（如"3人已参与"），用户报名后自动下发系统消息

### 19.2.3 通知策略重构

**旧策略 vs 新策略**：

| 场景 | 旧策略（订阅消息） | 新策略（群内系统消息） |
|------|-------------------|---------------------|
| 有人报名 | 发订阅消息给群主 → 可能没看到 | 群里自动冒泡「alex 已参与」→ 所有人看到 |
| 活动快开始 | 发订阅消息提醒 → 要授权 | 卡片状态变「即将开始」→ 无需授权 |
| 催人报名 | 没有能力 | `wx.notifyGroupMembers` 系统级 @ |
| 活动状态变化 | 站内通知 → 要打开小程序 | 卡片辅标题实时更新 → 群里直接看 |

**这不是「通知」，是「社交裂变」**：
- 每次报名 = 一次免费的群内广告
- 系统消息样式 = 比群主自己发的更有权威感
- 实时更新 = 制造紧迫感和从众效应

### 19.2.4 场景价值

| 场景 | 当前方案 | 聊天工具模式 |
|------|---------|-------------|
| 群内组局 | 复制链接 → 发群 → 手动统计 | 一键发卡片 → 自动统计 → 实时更新 |
| 报名提醒 | 群主手动 @ | 系统自动下发"alex 已参与 cindy 发布的 火锅局" |
| 参与状态 | 进小程序查看 | 卡片上直接显示"5人已参与" |
| 催人报名 | 群主手动 @ | `wx.notifyGroupMembers` 一键提醒 |
| 3缺1 场景 | 不知道还差几人 | 卡片实时显示「3/4人」→ 紧迫感拉满 |

### 19.2.5 技术约束

| 约束 | 说明 |
|------|------|
| 渲染引擎 | 必须使用 Skyline |
| 分包类型 | 独立分包 |
| 体积限制 | ≤ 500KB |
| 基础库 | ≥ 3.7.8 |
| 平台支持 | iOS/Android 微信 8.0.56+ |

### 19.2.6 分包配置示例

```json
{
  "subPackages": [
    {
      "root": "packageChatTool",
      "name": "chatTool",
      "pages": ["pages/index/index"],
      "independent": true,
      "componentFramework": "glass-easel",
      "renderer": "skyline"
    }
  ],
  "chatTools": [{
    "root": "packageChatTool",
    "entryPagePath": "pages/index/index",
    "desc": "群内快速组局",
    "scopes": ["scope.userLocation"]
  }]
}
```

### 19.2.7 核心 API

| API | 用途 |
|-----|------|
| `wx.openChatTool` | 从普通模式进入聊天工具模式 |
| `wx.getChatToolInfo` | 获取绑定群聊的 opengid / group_openid |
| `wx.selectGroupMembers` | 选择群成员（返回 group_openid） |
| `wx.shareAppMessageToGroup` | 发送小程序卡片到绑定群聊 |
| `wx.notifyGroupMembers` | @ 群成员提醒参与 |
| `wx.getApiCategory` | 判断当前是否处于聊天工具模式 |

### 19.2.8 动态消息流程

```
1. 服务端创建 activity_id（调用微信接口）
2. 前端 wx.updateShareMenu 声明动态消息
3. 用户分享卡片到群
4. 用户报名时，服务端调用 setChatToolMsg 更新状态
5. 卡片辅标题自动更新 + 下发系统消息
```

**动态消息模板**：
| templateId | 发布者视角 | 参与者视角 | 系统消息 |
|------------|-----------|-----------|---------|
| `4A68CBB...` | "X人已完成" | "未完成/已完成" | "alex 已完成 cindy 发布的 XXX" |
| `2A84254...` | "X人已参与" | "未参与/已参与" | "alex 已参与 cindy 发布的 XXX" |

### 19.2.9 用户流程

**发起者**：
```
普通模式首页 → 创建活动 → Widget_Share → [发到群聊] 
  → wx.openChatTool → 绑定群聊 → 发送动态卡片
```

**参与者**：
```
群聊点击卡片 → 聊天工具模式打开 → 查看详情 → 报名 
  → 卡片自动更新"X人已参与" + 系统消息通知群友
```

### 19.2.10 与现有架构的融合

| 现有能力 | 聊天工具模式增强 |
|---------|----------------|
| Widget_Share | 新增"发到群聊"按钮，触发 `wx.openChatTool` |
| 活动详情页 | 聊天工具模式下显示"提醒群友"按钮 |
| 报名成功 | 自动触发动态消息更新 |
| participants 表 | 新增 `group_openid` 字段关联群成员身份 |
| notifications 表 | 可考虑废弃或降级为备用方案 |

### 19.2.11 禁用能力

聊天工具模式下以下能力不可用：
- `button open-type="share"` / 右上角分享（使用专用 API 替代）
- `navigateToMiniProgram` / `openEmbeddedMiniProgram`
- 广告组件

### 19.2.12 实施优先级

| 阶段 | 内容 | 价值 |
|------|------|------|
| P0 | 基础分包 + 进入/退出流程 | 跑通链路 |
| P1 | 动态消息（卡片实时更新 + 系统消息） | **核心差异化，替代订阅消息** |
| P2 | 群成员选择 + @ 提醒 | 提升转化 |
| P3 | 群成员头像昵称渲染 | 体验优化 |

### 19.2.13 成功指标

| 指标 | 说明 | 目标 |
|------|------|------|
| 动态卡片分享率 | 使用聊天工具模式分享的比例 | ≥ 50% |
| 群内曝光→报名转化 | 看到系统消息后报名的比例 | ≥ 15% |
| 活动成局率提升 | 对比普通分享的成局率 | +20% |

---

## 附录：术语表

| 术语 | 说明 |
|------|------|
| **Brand_Slogan** | **"想怎么玩？跟小聚说说。" - 核心品牌口号** |
| **Brand_Subtitle** | **"Personal Social Agent" - 产品定位 (v3.5)** |
| **Personal_Social_Agent** | **个人社交代理人，聚场的核心定位** |
| **Agent_vs_Tool** | **Agent 是主动的（人与它协作），Tool 是被动的（人去操作它）** |
| **Chat_First** | **首页即对话，所有功能封装在对话流中，不是 UI 风格而是产品定位** |
| **Generative_UI** | **生成式界面，AI 根据意图动态生成最合适的 Widget** |
| **Memory_Layer** | **记忆层，AI 记住用户偏好，下次推荐更准** |
| Chat_Stream | 对话流，首页核心区域 |
| AI_Dock | 超级输入坞，底部悬浮的 AI 入口 |
| **XiaoJu (小聚)** | **AI 助理人格名，每个人的社交秘书** |
| Widget_Dashboard | 进场欢迎卡片 |
| Widget_Draft | 意图解析卡片（创建场景） |
| Widget_Share | 创建成功卡片 |
| **Widget_Explore** | **探索卡片（探索场景）** |
| **Explore_Map_Page** | **沉浸式地图页，全屏可交互地图** |
| **Invitation_Card** | **活动邀请函，AI 生成的精美活动卡片，用于分享到微信群** |
| **Intent_Classification** | **意图分类，区分创建 vs 探索 vs 闲聊** |
| **Emotion_Mapping** | **情绪映射，把用户的"情绪"映射到活动的"Tag"上** |
| Custom_Navbar | 自定义导航栏 |
| Profile_Page | 个人中心页 |
| Message_Center | 消息中心 |
| Dropmenu | 下拉菜单 |
| Lite_Chat | 活动临时群聊 |
| Location_Hint | 重庆地形适配的位置备注字段 |
| Share_Card | 微信原生分享卡片 |
| Soft_Tech | 柔和科技视觉风格 |
| Soft_Card | 实心白卡样式 |
| Cornflower_Blue | 矢车菊蓝 #5B75FB，主色调 |
| **Auth_Sheet** | **半屏授权弹窗，替代原生手机号授权弹窗** |
| **Share_Guide** | **分享引导蒙层，发布成功后引导用户分享** |
| **Activity_Preview_Sheet** | **活动预览浮层，地图页点击 Pin 时显示** |
| **Thinking_Bubble** | **AI 思考气泡，三个跳动的小圆点** |
| **Widget_Skeleton** | **卡片骨架屏，Widget 加载时的占位** |
| **Map_Picker** | **地图选点页，中心固定 Pin + 逆地址解析** |
| **Creator_Flow** | **发起者链路，从输入到分享的完整流程** |
| **Joiner_Flow** | **参与者链路，从点击卡片到报名的完整流程** |
| **Scenario_Split** | **场景隔离，聚场与粗门的差异化定位边界** |
| **Small_C** | **普通用户，区别于 Big C（俱乐部主理人、商家）** |
| **Long_Tail** | **长尾场景，80% 的生活/社交活动（聚场主攻）** |
| **Cold_Start_Strategy** | **冷启动策略，没有活动时用"话痨人格"保留存** |
| **Partner_Matching** | **找搭子能力，Agent 自然识别找搭子意图并帮用户匹配 (v4.0)** |
| **Partner_Intent** | **搭子意向，用户想参加某类活动的意愿表达 (v4.0)** |
| **Temp_Organizer** | **临时召集人，匹配成功后负责确认并转为活动的用户 (v4.0)** |
| **Widget_AskPreference** | **多轮对话偏好询问卡片，找搭子的结构化追问 (v4.0)** |

**设计原则*