# èšåœºå°ç¨‹åºè®¾è®¡æ–‡æ¡£ (SDD)

## Overview

æœ¬è®¾è®¡æ–‡æ¡£æè¿°èšåœº(JuChang)å°ç¨‹åºçš„æŠ€æœ¯æ¶æ„å’Œé¡µé¢ç»“æ„ã€‚å°ç¨‹åºåŸºäºå¾®ä¿¡åŸç”Ÿå¼€å‘æ¡†æ¶ï¼Œä½¿ç”¨TDesignç»„ä»¶åº“ï¼Œé€šè¿‡Orvalç”Ÿæˆçš„SDKä¸åç«¯APIé€šä¿¡ã€‚

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ (TypeScript)
- **UIç»„ä»¶**: TDesign Miniprogram
- **æ ·å¼**: LESS + TailwindCSS (weapp-tailwindcss)
- **APIé€šä¿¡**: Orvalç”Ÿæˆçš„TypeScript SDK
- **çŠ¶æ€ç®¡ç†**: Zustand + å°ç¨‹åºåŸç”ŸPage/Component data
- **åœ°å›¾**: å¾®ä¿¡å°ç¨‹åºmapç»„ä»¶

## Architecture

### é¡µé¢æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èšåœºå°ç¨‹åºé¡µé¢æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ä¸»åŒ… Pages (TabBar)                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚   Map   â”‚ â”‚ Message â”‚ â”‚   My    â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  åœ°å›¾   â”‚ â”‚  æ¶ˆæ¯   â”‚ â”‚  æˆ‘çš„   â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              åˆ†åŒ… Subpackages                        â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  activity/          chat/           login/          â”‚   â”‚
â”‚  â”‚  â”œâ”€ detail/         â””â”€ index        â””â”€ login        â”‚   â”‚
â”‚  â”‚  â”œâ”€ create/                                         â”‚   â”‚
â”‚  â”‚  â””â”€ confirm/        search/         setting/        â”‚   â”‚
â”‚  â”‚                     â””â”€ index        â””â”€ index        â”‚   â”‚
â”‚  â”‚  my/info-edit/                                      â”‚   â”‚
â”‚  â”‚  â””â”€ index           dataCenter/     loginCode/      â”‚   â”‚
â”‚  â”‚                     â””â”€ index        â””â”€ loginCode    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å…¨å±€ç»„ä»¶ Components                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ tab-bar  â”‚ â”‚ bottom-  â”‚ â”‚ floating â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ (Custom) â”‚ â”‚ drawer   â”‚ â”‚ buttons  â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ activity â”‚ â”‚ filter-  â”‚ â”‚ feedback â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ card     â”‚ â”‚ panel    â”‚ â”‚ dialog   â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              æœåŠ¡å±‚ Services                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚   API    â”‚ â”‚  Auth    â”‚ â”‚ Location â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ (Orval)  â”‚ â”‚ (Token)  â”‚ â”‚  (LBS)   â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚  â”‚ Storage  â”‚ â”‚ Payment  â”‚                         â”‚   â”‚
â”‚  â”‚  â”‚ (Cache)  â”‚ â”‚ (WxPay)  â”‚                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
apps/miniprogram/
â”œâ”€â”€ pages/                      # ä¸»åŒ…é¡µé¢ (TabBar)
â”‚   â”œâ”€â”€ map/                    # Tab1: åœ°å›¾é¦–é¡µ âœ…
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â”œâ”€â”€ index.less
â”‚   â”‚   â””â”€â”€ index.json
â”‚   â”œâ”€â”€ message/                # Tab2: æ¶ˆæ¯ä¸­å¿ƒ âœ…
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â”œâ”€â”€ index.less
â”‚   â”‚   â””â”€â”€ index.json
â”‚   â””â”€â”€ my/                     # Tab3: ä¸ªäººä¸­å¿ƒ âœ…
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ index.wxml
â”‚       â”œâ”€â”€ index.less
â”‚       â”œâ”€â”€ index.json
â”‚       â””â”€â”€ info-edit/          # ä¸ªäººèµ„æ–™ç¼–è¾‘ (åˆ†åŒ…)
â”‚
â”œâ”€â”€ subpackages/                # åˆ†åŒ…é¡µé¢
â”‚   â””â”€â”€ activity/               # æ´»åŠ¨ç›¸å…³
â”‚       â”œâ”€â”€ detail/             # æ´»åŠ¨è¯¦æƒ… âœ…
â”‚       â”œâ”€â”€ create/             # åˆ›å»ºæ´»åŠ¨ âœ…
â”‚       â””â”€â”€ confirm/            # å±¥çº¦ç¡®è®¤ âœ…
â”‚
â”œâ”€â”€ components/                 # å…¨å±€ç»„ä»¶
â”‚   â”œâ”€â”€ custom-tab-bar/         # è‡ªå®šä¹‰TabBar âœ…
â”‚   â”œâ”€â”€ bottom-drawer/          # åº•éƒ¨æŠ½å±‰ âœ…
â”‚   â”œâ”€â”€ floating-buttons/       # æµ®åŠ¨æŒ‰é’® âœ…
â”‚   â”œâ”€â”€ activity-card/          # æ´»åŠ¨å¡ç‰‡ âœ…
â”‚   â”œâ”€â”€ filter-panel/           # ç­›é€‰é¢æ¿ âœ…
â”‚   â”œâ”€â”€ feedback-dialog/        # åé¦ˆå¼¹çª— âœ…
â”‚   â”œâ”€â”€ card/                   # é€šç”¨å¡ç‰‡
â”‚   â””â”€â”€ nav/                    # å¯¼èˆªç»„ä»¶
â”‚
â”œâ”€â”€ src/                        # æºç 
â”‚   â”œâ”€â”€ api/                    # Orvalç”Ÿæˆçš„API SDK
â”‚   â”‚   â”œâ”€â”€ endpoints/          # APIç«¯ç‚¹å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ model/              # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ stores/                 # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ app.ts              # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â””â”€â”€ user.ts             # ç”¨æˆ·çŠ¶æ€
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ wx-request.ts       # è¯·æ±‚å°è£…
â”‚   â””â”€â”€ types/                  # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ global.d.ts
â”‚       â””â”€â”€ global.ts
â”‚
â”œâ”€â”€ static/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ pins/                   # åœ°å›¾Pinå›¾æ ‡
â”‚   â”œâ”€â”€ chat/                   # èŠå¤©å¤´åƒ
â”‚   â””â”€â”€ home/                   # é¦–é¡µå›¾ç‰‡
â”‚
â”œâ”€â”€ mock/                       # Mockæ•°æ® (å¼€å‘ç”¨)
â”‚
â”œâ”€â”€ app.ts                      # åº”ç”¨å…¥å£
â”œâ”€â”€ app.json                    # åº”ç”¨é…ç½®
â”œâ”€â”€ app.less                    # å…¨å±€æ ·å¼
â””â”€â”€ project.config.json         # é¡¹ç›®é…ç½®
```

## é¡µé¢è¯¦ç»†è®¾è®¡

### ä¸»åŒ…é¡µé¢ (TabBar)

#### 1. åœ°å›¾é¡µ (pages/map)

**è·¯å¾„**: `pages/map/index`
**ç±»å‹**: TabBaré¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- å…¨å±åœ°å›¾å±•ç¤ºï¼Œä»¥ç”¨æˆ·ä½ç½®ä¸ºä¸­å¿ƒ
- æ´»åŠ¨Pinæ¸²æŸ“ï¼ˆæ™®é€š/Pin+/Boostï¼‰
- åº•éƒ¨æŠ½å±‰ï¼ˆç­›é€‰ã€åˆ›å»ºå…¥å£ã€æ´»åŠ¨åˆ—è¡¨ï¼‰
- æµ®åŠ¨æŒ‰é’®ï¼ˆå®šä½ã€å®‰å…¨ä¸­å¿ƒï¼‰
- ç‚¹å‡»Pinæ˜¾ç¤ºæ´»åŠ¨å¡ç‰‡å¼¹çª—

**APIè°ƒç”¨**:
- `GET /activities/nearby` - è·å–é™„è¿‘æ´»åŠ¨
- `GET /activities/:id` - è·å–æ´»åŠ¨è¯¦æƒ…

---

#### 2. æ¶ˆæ¯é¡µ (pages/message)

**è·¯å¾„**: `pages/message/index`
**ç±»å‹**: TabBaré¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- ç³»ç»Ÿé€šçŸ¥åˆ—è¡¨ï¼ˆç”³è¯·é€šçŸ¥ã€å±¥çº¦é€šçŸ¥ã€ç”³è¯‰é€šçŸ¥ï¼‰
- ç¾¤èŠåˆ—è¡¨ï¼ˆæ´»åŠ¨ç¾¤èŠå…¥å£ï¼‰
- æœªè¯»æ¶ˆæ¯è§’æ ‡
- ç”³è¯‰æŒ‰é’®ï¼ˆè¢«æ ‡è®°æœªåˆ°åœºæ—¶æ˜¾ç¤ºï¼‰

**APIè°ƒç”¨**:
- `GET /notifications` - è·å–é€šçŸ¥åˆ—è¡¨
- `GET /notifications/unread-count` - è·å–æœªè¯»æ•°é‡
- `POST /notifications/:id/read` - æ ‡è®°å·²è¯»

---

#### 3. æˆ‘çš„é¡µ (pages/my)

**è·¯å¾„**: `pages/my/index`
**ç±»å‹**: TabBaré¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- ç”¨æˆ·å¤´åƒã€æ˜µç§°ã€é è°±åº¦å±•ç¤º
- ç»Ÿè®¡æ•°æ®ï¼ˆç»„ç»‡åœºæ¬¡ã€å‚ä¸åœºæ¬¡ã€å·®è¯„æ¬¡æ•°ï¼‰
- æˆ‘å‘å¸ƒçš„æ´»åŠ¨å…¥å£
- æˆ‘å‚ä¸çš„æ´»åŠ¨å…¥å£
- è®¾ç½®å…¥å£
- æœªç™»å½•çŠ¶æ€æ˜¾ç¤ºç™»å½•å…¥å£

**APIè°ƒç”¨**:
- `GET /users/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `GET /users/me/stats` - è·å–ç”¨æˆ·ç»Ÿè®¡

---

### åˆ†åŒ…é¡µé¢ (Subpackages)

#### 4. æ´»åŠ¨è¯¦æƒ…é¡µ (subpackages/activity/detail)

**è·¯å¾„**: `subpackages/activity/detail/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- æ´»åŠ¨å®Œæ•´ä¿¡æ¯å±•ç¤ºï¼ˆæ ‡é¢˜ã€æè¿°ã€å›¾ç‰‡ã€æ—¶é—´ã€åœ°ç‚¹ã€äººæ•°ã€è´¹ç”¨ï¼‰
- ç§å¯†å±€æ˜¾ç¤ºæ¨¡ç³Šåœ°å€
- å‘èµ·äººä¿¡æ¯å’Œé è°±åº¦
- å‚ä¸è€…åˆ—è¡¨é¢„è§ˆ
- æŠ¥åæŒ‰é’®ï¼ˆæ ¡éªŒé è°±åº¦é—¨æ§›ï¼‰
- Fast Passé€‰é¡¹ï¼ˆçƒ­é—¨æ´»åŠ¨ï¼‰
- åˆ†äº«åŠŸèƒ½

**APIè°ƒç”¨**:
- `GET /activities/:id` - è·å–æ´»åŠ¨è¯¦æƒ…
- `POST /participants` - æŠ¥åæ´»åŠ¨
- `GET /activities/:id/share` - è·å–åˆ†äº«æ•°æ®

---

#### 5. åˆ›å»ºæ´»åŠ¨é¡µ (subpackages/activity/create)

**è·¯å¾„**: `subpackages/activity/create/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- æ´»åŠ¨è¡¨å•ï¼ˆæ ‡é¢˜ã€æè¿°ã€æ—¶é—´ã€åœ°ç‚¹ã€äººæ•°ã€è´¹ç”¨ç±»å‹ï¼‰
- ä½ç½®é€‰æ‹©ï¼ˆå¼ºåˆ¶å¡«å†™ä½ç½®å¤‡æ³¨ï¼‰
- éšç§è®¾ç½®ï¼ˆæ¨¡ç³Šåœ°ç†ä½ç½®ï¼‰
- æ¨å¹¿é€‰é¡¹ï¼ˆBoost Â¥3ã€Pin+ Â¥5ï¼‰
- è¡¨å•éªŒè¯å’Œæäº¤
- åˆ›å»ºæˆåŠŸååˆ†äº«

**APIè°ƒç”¨**:
- `POST /activities` - åˆ›å»ºæ´»åŠ¨
- `POST /transactions` - è´­ä¹°å¢å€¼æœåŠ¡

---

#### 6. å±¥çº¦ç¡®è®¤é¡µ (subpackages/activity/confirm)

**è·¯å¾„**: `subpackages/activity/confirm/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- å‚ä¸è€…åˆ—è¡¨ï¼ˆé»˜è®¤å…¨é€‰å·²åˆ°åœºï¼‰
- æ ‡è®°æœªåˆ°åœºï¼ˆæ˜¾ç¤ºè­¦å‘Šï¼šæ‰£é™¤1%é è°±åº¦ï¼‰
- ç¡®è®¤æäº¤

**APIè°ƒç”¨**:
- `GET /activities/:id/participants` - è·å–å‚ä¸è€…åˆ—è¡¨
- `POST /participants/confirm` - æäº¤å±¥çº¦ç¡®è®¤

---

#### 7. ç¾¤èŠé¡µ (pages/chat)

**è·¯å¾„**: `pages/chat/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- æ´»åŠ¨ä¿¡æ¯å¤´éƒ¨
- æ¶ˆæ¯åˆ—è¡¨
- å‘é€æ–‡æœ¬æ¶ˆæ¯
- å®æ—¶æ¶ˆæ¯æ¥æ”¶

**APIè°ƒç”¨**:
- `GET /chat/:activityId/messages` - è·å–æ¶ˆæ¯å†å²
- `POST /chat/:activityId/messages` - å‘é€æ¶ˆæ¯

---

#### 8. ç™»å½•é¡µ (pages/login)

**è·¯å¾„**: `pages/login/login`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- å¾®ä¿¡ä¸€é”®ç™»å½•
- è·å–ç”¨æˆ·ä¿¡æ¯æˆæƒ

**APIè°ƒç”¨**:
- `POST /auth/wx-login` - å¾®ä¿¡ç™»å½•

---

#### 9. ä¸ªäººèµ„æ–™ç¼–è¾‘é¡µ (pages/my/info-edit)

**è·¯å¾„**: `pages/my/info-edit/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: âœ… å·²å®ç°

**åŠŸèƒ½**:
- ç¼–è¾‘å¤´åƒã€æ˜µç§°ã€ç®€ä»‹
- ä¿å­˜ä¸ªäººä¿¡æ¯

**APIè°ƒç”¨**:
- `PATCH /users/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

---

#### 10. è®¾ç½®é¡µ (pages/setting)

**è·¯å¾„**: `pages/setting/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: ğŸ”„ å¾…å®Œå–„

**åŠŸèƒ½**:
- é€šçŸ¥è®¾ç½®
- éšç§è®¾ç½®
- å…³äºæˆ‘ä»¬
- é€€å‡ºç™»å½•

---

#### 11. æœç´¢é¡µ (pages/search)

**è·¯å¾„**: `pages/search/index`
**ç±»å‹**: åˆ†åŒ…é¡µé¢
**çŠ¶æ€**: ğŸ”„ å¾…å®Œå–„

**åŠŸèƒ½**:
- æ´»åŠ¨æœç´¢
- æœç´¢å†å²
- çƒ­é—¨æœç´¢

**APIè°ƒç”¨**:
- `GET /activities` - æœç´¢æ´»åŠ¨

---

### å¾…æ¸…ç†çš„é—ç•™é¡µé¢

ä»¥ä¸‹é¡µé¢ä¸ºæ—§ç‰ˆé—ç•™ï¼Œéœ€è¦æ¸…ç†æˆ–é‡æ„ï¼š

| é¡µé¢ | è·¯å¾„ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| home | pages/home | âŒ åºŸå¼ƒ | å·²è¢« pages/map æ›¿ä»£ |
| ai | pages/ai | âŒ åºŸå¼ƒ | PRD V9.2 ç§»é™¤ç‹¬ç«‹AIé¡µ |
| release | pages/release | âŒ åºŸå¼ƒ | å·²è¢« activity/create æ›¿ä»£ |
| dataCenter | pages/dataCenter | âŒ åºŸå¼ƒ | éæ ¸å¿ƒåŠŸèƒ½ |
| loginCode | pages/loginCode | âŒ åºŸå¼ƒ | åˆå¹¶åˆ° login |

## Components and Interfaces

### å…¨å±€ç»„ä»¶

#### 1. Custom TabBar (custom-tab-bar)

è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ ï¼Œ3ä¸ªTab + ä¸­å¤®FABæŒ‰é’®ã€‚

```typescript
interface TabBarData {
  value: 'map' | 'message' | 'my';
  unreadNum: number;
}
```

#### 2. Bottom Drawer (bottom-drawer)

åº•éƒ¨å¯æ»‘åŠ¨æŠ½å±‰ï¼Œç”¨äºåœ°å›¾é¡µé¢ã€‚

```typescript
interface BottomDrawerProps {
  minHeight?: number;   // æ”¶èµ·é«˜åº¦ï¼Œé»˜è®¤ 200rpx
  maxHeight?: number;   // å±•å¼€é«˜åº¦ï¼Œé»˜è®¤ 70vh
}
```

#### 3. Floating Buttons (floating-buttons)

åœ°å›¾æµ®åŠ¨æŒ‰é’®ç»„ä»¶ã€‚

```typescript
// æŒ‰é’®é…ç½®
const BUTTONS = [
  { id: 'safety', icon: 'shield', position: 'left-top' },
  { id: 'location', icon: 'location', position: 'right-center' },
];
```

#### 4. Activity Card (activity-card)

æ´»åŠ¨ä¿¡æ¯å¡ç‰‡ï¼Œç”¨äºåœ°å›¾å¼¹çª—å’Œåˆ—è¡¨ã€‚

```typescript
interface ActivityCardProps {
  activity: Activity;
  mode: 'popup' | 'list';
  showDistance?: boolean;
}
```

#### 5. Filter Panel (filter-panel)

æ´»åŠ¨ç­›é€‰é¢æ¿ã€‚

```typescript
interface FilterOptions {
  time: 'today' | 'tomorrow' | 'week' | 'all';
  type: ActivityType[];
  gender: 'all' | 'female_only' | 'male_only';
  minReliability: number;
  distance: 1 | 3 | 5 | 10;
  status: ActivityStatus[];
  feeType: FeeType[];
}
```

#### 6. Feedback Dialog (feedback-dialog)

å·®è¯„åé¦ˆå¼¹çª—ã€‚

```typescript
interface FeedbackDialogProps {
  activityId: string;
  participants: User[];
  onSubmit: (feedback: Feedback) => void;
}
```

## Data Models

æ•°æ®æ¨¡å‹ä»åç«¯ API å“åº”æ´¾ç”Ÿï¼Œé€šè¿‡ Orval ç”Ÿæˆ TypeScript ç±»å‹ã€‚

### æ ¸å¿ƒç±»å‹

```typescript
// ä» Orval ç”Ÿæˆçš„ API ç±»å‹
import type { 
  User, 
  Activity, 
  Participant,
  ChatMessage,
  Notification,
  Feedback 
} from '@/api/model';

// å°ç¨‹åºç«¯æ‰©å±•ç±»å‹
interface ActivityWithDistance extends Activity {
  distance: number; // ä¸ç”¨æˆ·çš„è·ç¦»(ç±³)
}

// é è°±åº¦è®¡ç®—
function getReliabilityRate(user: User): number {
  if (user.participationCount === 0) return -1;
  return Math.round((user.fulfillmentCount / user.participationCount) * 100);
}

function getReliabilityLabel(rate: number): string {
  if (rate === -1) return 'ğŸ†• æ–°ç”¨æˆ·';
  if (rate === 100) return 'â­â­â­ éå¸¸é è°±';
  if (rate >= 80) return 'â­â­ é è°±';
  if (rate >= 60) return 'â­ ä¸€èˆ¬';
  return 'å¾…æå‡';
}
```

### æœ¬åœ°å­˜å‚¨

```typescript
const STORAGE_KEYS = {
  TOKEN: 'token',
  USER_INFO: 'userInfo',
  LAST_LOCATION: 'lastLocation',
  FILTER_OPTIONS: 'filterOptions',
};
```

## API é›†æˆ

### Orval SDK ç”Ÿæˆ

ä½¿ç”¨ Orval ä»åç«¯ OpenAPI è§„èŒƒç”Ÿæˆ TypeScript SDKï¼š

```bash
cd apps/miniprogram
bun run gen:api
```

ç”Ÿæˆçš„ SDK ä½äº `apps/miniprogram/src/api/`ï¼š
- `endpoints/` - API è°ƒç”¨å‡½æ•°
- `model/` - TypeScript ç±»å‹å®šä¹‰

### è¯·æ±‚å°è£…

```typescript
// src/utils/wx-request.ts
// å°è£… wx.requestï¼Œæ”¯æŒ Token æ³¨å…¥ã€é”™è¯¯å¤„ç†
```

## Error Handling

### API é”™è¯¯å¤„ç†

```typescript
function handleAPIError(error: { code: number; msg: string }): void {
  switch (error.code) {
    case 401:
      wx.removeStorageSync('token');
      wx.navigateTo({ url: '/pages/login/login' });
      break;
    case 403:
      wx.showToast({ title: 'æƒé™ä¸è¶³', icon: 'none' });
      break;
    case 404:
      wx.showToast({ title: 'å†…å®¹ä¸å­˜åœ¨', icon: 'none' });
      break;
    default:
      wx.showToast({ title: error.msg || 'ç½‘ç»œé”™è¯¯', icon: 'none' });
  }
}
```

### ä½ç½®æƒé™å¤„ç†

```typescript
async function requestLocationPermission(): Promise<boolean> {
  try {
    await wx.authorize({ scope: 'scope.userLocation' });
    return true;
  } catch {
    wx.showModal({
      title: 'éœ€è¦ä½ç½®æƒé™',
      content: 'è¯·åœ¨è®¾ç½®ä¸­å¼€å¯ä½ç½®æƒé™',
      confirmText: 'å»è®¾ç½®',
      success: (res) => {
        if (res.confirm) wx.openSetting();
      }
    });
    return false;
  }
}
```

## é¡µé¢è·¯ç”±é…ç½®

### app.json é…ç½®

```json
{
  "pages": [
    "pages/map/index",
    "pages/message/index",
    "pages/my/index"
  ],
  "subpackages": [
    {
      "root": "subpackages/activity",
      "pages": ["detail/index", "create/index", "confirm/index"]
    },
    { "root": "pages/chat", "pages": ["index"] },
    { "root": "pages/login", "pages": ["login"] },
    { "root": "pages/my/info-edit", "pages": ["index"] },
    { "root": "pages/search", "pages": ["index"] },
    { "root": "pages/setting", "pages": ["index"] }
  ],
  "tabBar": {
    "custom": true,
    "list": [
      { "pagePath": "pages/map/index", "text": "åœ°å›¾" },
      { "pagePath": "pages/message/index", "text": "æ¶ˆæ¯" },
      { "pagePath": "pages/my/index", "text": "æˆ‘çš„" }
    ]
  }
}
```

## Testing Strategy

ç”±äºå¾®ä¿¡å°ç¨‹åºç¯å¢ƒé™åˆ¶ï¼Œé‡‡ç”¨æ‰‹åŠ¨æµ‹è¯•ä¸ºä¸»ï¼š

1. **å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•** - çœŸæœºé¢„è§ˆå’Œæ¨¡æ‹Ÿå™¨æµ‹è¯•
2. **API Mock** - å¼€å‘é˜¶æ®µä½¿ç”¨ mock æ•°æ®
3. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•** - ç©ºæ•°æ®ã€ç½‘ç»œé”™è¯¯ã€æƒé™æ‹’ç»ç­‰

### æµ‹è¯•æ£€æŸ¥æ¸…å•

**å¯¼èˆªæµ‹è¯•**
- [ ] 3ä¸ªTabåˆ‡æ¢æ­£å¸¸
- [ ] é¡µé¢è·³è½¬å’Œè¿”å›æ­£å¸¸

**åœ°å›¾æµ‹è¯•**
- [ ] ä½ç½®æƒé™è¯·æ±‚æ­£å¸¸
- [ ] åœ°å›¾åŠ è½½å’ŒPinæ¸²æŸ“æ­£å¸¸
- [ ] æµ®åŠ¨æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] åº•éƒ¨æŠ½å±‰æ»‘åŠ¨æ­£å¸¸
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸

**æ´»åŠ¨æµç¨‹æµ‹è¯•**
- [ ] åˆ›å»ºæ´»åŠ¨æµç¨‹å®Œæ•´
- [ ] æŠ¥åæµç¨‹æ­£å¸¸
- [ ] å±¥çº¦ç¡®è®¤æµç¨‹æ­£å¸¸

**æƒé™æµ‹è¯•**
- [ ] æœªç™»å½•å¯æµè§ˆåœ°å›¾
- [ ] æœªç™»å½•åˆ›å»º/æŠ¥å/ç¾¤èŠè·³è½¬ç™»å½•é¡µ
