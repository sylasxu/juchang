<!--
  CUI 副驾面板组件
  Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.7
-->
<view class="cui-panel {{visible ? 'visible' : ''}}" catchtouchmove="preventScroll">
  <!-- 遮罩层 -->
  <view class="cui-mask" wx:if="{{visible}}" bindtap="onMaskTap"></view>
  
  <!-- 面板内容 -->
  <view class="cui-content {{visible ? 'slide-up' : ''}}">
    <!-- 头部拖拽条 -->
    <view class="flex items-center justify-center py-3 px-4 relative">
      <view class="cui-drag-bar"></view>
      <view class="absolute right-4 top-1/2 -translate-y-1/2 p-2 text-gray-400" bindtap="onClose">
        <t-icon name="close" size="40rpx" />
      </view>
    </view>
    
    <!-- 思考态 -->
    <view class="cui-phase" wx:if="{{phase === 'thinking'}}">
      <view class="thinking-icon">
        <view class="thinking-dot"></view>
        <view class="thinking-dot"></view>
        <view class="thinking-dot"></view>
      </view>
      <text class="text-lg text-gray-900 text-center">{{thinkingText}}</text>
    </view>
    
    <!-- 搜索态 -->
    <view class="cui-phase" wx:if="{{phase === 'searching'}}">
      <view class="searching-icon">
        <t-icon name="search" size="48rpx" />
      </view>
      <text class="text-lg text-gray-900 text-center mb-3 typing-effect">{{searchingText}}</text>
      <view class="searching-progress">
        <view class="progress-bar" style="width: {{searchProgress}}%"></view>
      </view>
    </view>
    
    <!-- 结果态 -->
    <view class="cui-phase result" wx:if="{{phase === 'result'}}">
      <view class="flex flex-col gap-3 w-full">
        <!-- 发现活动卡片 -->
        <view 
          class="found-card"
          wx:if="{{foundActivities.length > 0}}"
          bindtap="onFoundCardTap"
        >
          <view class="text-2xl mr-3">🔍</view>
          <view class="flex-1 flex flex-col">
            <text class="text-lg font-semibold text-gray-900">发现 {{foundActivities.length}} 个局</text>
            <text class="text-sm text-gray-400 mt-1">去看看？</text>
          </view>
          <t-icon name="chevron-right" size="40rpx" color="#999" />
        </view>
        
        <!-- 创建草稿卡片 -->
        <draft-card 
          wx:if="{{draftCard}}"
          draft="{{draftCard}}"
          bind:publish="onDraftPublish"
        />
        
        <!-- 无匹配时的提示 -->
        <view wx:if="{{foundActivities.length === 0 && !draftCard}}" class="flex flex-col items-center py-6">
          <text class="text-lg text-gray-600">暂无匹配的活动</text>
          <text class="text-sm text-gray-400 mt-2">试试换个关键词？</text>
        </view>
      </view>
    </view>
    
    <!-- 错误态 -->
    <view class="cui-phase" wx:if="{{phase === 'error'}}">
      <view class="text-4xl mb-3">😅</view>
      <text class="text-lg text-gray-600 text-center mb-4">{{errorText || 'AI 暂时开小差了'}}</text>
      <view class="px-6 py-2 bg-brand text-white rounded-full text-base" bindtap="onRetry">
        <text>重试</text>
      </view>
    </view>
    
    <!-- 空闲态 -->
    <view class="cui-phase" wx:if="{{phase === 'idle'}}">
      <view class="text-4xl mb-3">🤖</view>
      <text class="text-lg text-gray-600">有什么可以帮你的？</text>
    </view>
  </view>
</view>
