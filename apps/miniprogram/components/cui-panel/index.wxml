<!--
  CUI 副驾面板组件
  Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.7
  
  AI交互面板，展示流式响应
  - 思考态：显示思考文案
  - 搜索态：显示搜索进度
  - 结果态：显示双选卡片
-->
<view class="cui-panel {{visible ? 'visible' : ''}}" catchtouchmove="preventScroll">
  <!-- 遮罩层 -->
  <view class="cui-mask" wx:if="{{visible}}" bindtap="onMaskTap"></view>
  
  <!-- 面板内容 -->
  <view class="cui-content {{visible ? 'slide-up' : ''}}">
    <!-- 头部拖拽条 -->
    <view class="cui-header">
      <view class="cui-drag-bar"></view>
      <view class="cui-close" bindtap="onClose">
        <t-icon name="close" size="40rpx" />
      </view>
    </view>
    
    <!-- 思考态 - Requirements: 3.1 -->
    <view class="cui-phase thinking" wx:if="{{phase === 'thinking'}}">
      <view class="thinking-icon">
        <view class="thinking-dot"></view>
        <view class="thinking-dot"></view>
        <view class="thinking-dot"></view>
      </view>
      <text class="thinking-text">{{thinkingText}}</text>
    </view>
    
    <!-- 搜索态 - Requirements: 3.3 -->
    <view class="cui-phase searching" wx:if="{{phase === 'searching'}}">
      <view class="searching-icon">
        <t-icon name="search" size="48rpx" />
      </view>
      <text class="searching-text typing-effect">{{searchingText}}</text>
      <view class="searching-progress">
        <view class="progress-bar" style="width: {{searchProgress}}%"></view>
      </view>
    </view>
    
    <!-- 结果态 - Requirements: 3.4, 3.5 -->
    <view class="cui-phase result" wx:if="{{phase === 'result'}}">
      <!-- 有匹配活动时显示双选卡片 -->
      <view class="result-cards">
        <!-- 发现活动卡片 - Requirements: 3.4 -->
        <view 
          class="result-card found-card" 
          wx:if="{{foundActivities.length > 0}}"
          bindtap="onFoundCardTap"
        >
          <view class="card-icon">🔍</view>
          <view class="card-content">
            <text class="card-title">发现 {{foundActivities.length}} 个局</text>
            <text class="card-subtitle">去看看？</text>
          </view>
          <view class="card-arrow">
            <t-icon name="chevron-right" size="40rpx" />
          </view>
        </view>
        
        <!-- 创建草稿卡片 - Requirements: 3.5, 3.7 -->
        <draft-card 
          wx:if="{{draftCard}}"
          draft="{{draftCard}}"
          bind:publish="onDraftPublish"
        />
        
        <!-- 无匹配时的提示 -->
        <view class="no-match-tip" wx:if="{{foundActivities.length === 0 && !draftCard}}">
          <text class="tip-text">暂无匹配的活动</text>
          <text class="tip-sub">试试换个关键词？</text>
        </view>
      </view>
    </view>
    
    <!-- 错误态 -->
    <view class="cui-phase error" wx:if="{{phase === 'error'}}">
      <view class="error-icon">😅</view>
      <text class="error-text">{{errorText || 'AI 暂时开小差了'}}</text>
      <view class="error-retry" bindtap="onRetry">
        <text>重试</text>
      </view>
    </view>
    
    <!-- 空闲态 -->
    <view class="cui-phase idle" wx:if="{{phase === 'idle'}}">
      <view class="idle-icon">🤖</view>
      <text class="idle-text">有什么可以帮你的？</text>
    </view>
  </view>
</view>
