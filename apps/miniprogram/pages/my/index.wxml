<!--
  个人中心页面
  Requirements: 12.1, 12.2, 12.3, 12.4, 12.5
-->
<view class="my-page">
  <!-- 背景 -->
  <view class="header-bg"></view>

  <!-- 导航栏 -->
  <t-navbar title="我的" t-class="navbar-transparent" />

  <!-- 用户信息卡片 -->
  <view class="user-card">
    <!-- 已登录状态 -->
    <block wx:if="{{isLoad && userInfo}}">
      <view class="user-header" bind:tap="onNavigateTo">
        <t-avatar
          image="{{userInfo.avatarUrl}}"
          icon="user"
          size="128rpx"
          class="user-avatar"
        />
        <view class="user-info">
          <view class="user-name">{{userInfo.nickname || '聚场用户'}}</view>
          <view class="user-bio" wx:if="{{userInfo.bio}}">{{userInfo.bio}}</view>
          <!-- 靠谱度徽章 (Requirements: 14.1, 14.2, 14.3, 14.4) -->
          <view class="user-tags">
            <reliability-badge rate="{{reliabilityRate}}" show-label="{{true}}" />
            <view class="member-tag" wx:if="{{userInfo.membershipType === 'pro'}}">
              <t-icon name="crown-filled" size="28rpx" />
              <text>Pro会员</text>
            </view>
          </view>
        </view>
        <t-icon name="chevron-right" size="44rpx" color="#999" />
      </view>

      <!-- 统计数据 (Requirements: 12.2) -->
      <view class="user-stats">
        <view class="stat-item">
          <text class="stat-value">{{userInfo.activitiesCreatedCount || 0}}</text>
          <text class="stat-label">组织场次</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{userInfo.participationCount || 0}}</text>
          <text class="stat-label">参与场次</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{userInfo.fulfillmentCount || 0}}</text>
          <text class="stat-label">履约次数</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value {{(userInfo.negativeFeedbackCount || 0) > 0 ? 'warning' : ''}}">
            {{userInfo.negativeFeedbackCount || 0}}
          </text>
          <text class="stat-label">收到差评</text>
        </view>
      </view>
    </block>

    <!-- 未登录状态 (Requirements: 12.5) -->
    <view wx:else class="login-prompt" bind:tap="onLogin">
      <t-avatar icon="user" size="128rpx" class="user-avatar" />
      <view class="login-text">
        <text class="login-title">登录/注册</text>
        <text class="login-desc">登录后享受更多功能</text>
      </view>
      <t-icon name="chevron-right" size="44rpx" color="#999" />
    </view>
  </view>

  <!-- 功能网格 (Requirements: 12.3, 12.4) -->
  <view class="function-grid">
    <view
      wx:for="{{gridList}}"
      wx:key="type"
      class="grid-item"
      data-data="{{item}}"
      bind:tap="onEleClick"
    >
      <view class="grid-icon">
        <t-icon name="{{item.icon}}" size="48rpx" />
        <view class="grid-badge" wx:if="{{item.badge}}">{{item.badge}}</view>
      </view>
      <text class="grid-text">{{item.name}}</text>
    </view>
  </view>

  <!-- 设置列表 -->
  <view class="settings-section">
    <t-cell-group theme="card">
      <t-cell
        wx:for="{{settingList}}"
        wx:key="type"
        title="{{item.name}}"
        leftIcon="{{item.icon}}"
        hover
        arrow
        data-data="{{item}}"
        bind:click="onEleClick"
      />
      <!-- 退出登录 -->
      <t-cell
        wx:if="{{isLoad}}"
        title="退出登录"
        leftIcon="logout"
        hover
        bind:click="onLogout"
        t-class-title="logout-text"
      />
    </t-cell-group>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-area"></view>
</view>
