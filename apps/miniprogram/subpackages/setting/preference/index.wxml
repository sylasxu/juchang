<!--
  偏好设置页面
  v4.4 新增
  
  用户可以设置活动类型、时间偏好、常去地点、社交偏好
-->
<view class="preference-page">
  <!-- 自定义导航栏 -->
  <custom-navbar title="我的偏好" />
  
  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <t-loading theme="circular" size="48rpx" />
    <text class="loading-text">加载中...</text>
  </view>
  
  <!-- 偏好设置表单 -->
  <scroll-view wx:else class="preference-content" scroll-y enhanced show-scrollbar="{{false}}">
    <!-- 活动类型 -->
    <view class="preference-section">
      <view class="section-header">
        <text class="section-icon">🎯</text>
        <text class="section-title">活动类型</text>
      </view>
      <view class="section-desc">选择你喜欢的活动类型</view>
      <view class="options-grid">
        <view 
          wx:for="{{activityTypes}}" 
          wx:key="value"
          class="option-item {{item.selected ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="onActivityTypeToggle"
        >
          <text class="option-icon">{{item.icon}}</text>
          <text class="option-label">{{item.label}}</text>
        </view>
      </view>
    </view>
    
    <!-- 时间偏好 -->
    <view class="preference-section">
      <view class="section-header">
        <text class="section-icon">⏰</text>
        <text class="section-title">时间偏好</text>
      </view>
      <view class="section-desc">你通常什么时候有空</view>
      <view class="options-row">
        <view 
          wx:for="{{timePreferences}}" 
          wx:key="value"
          class="option-tag {{item.selected ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="onTimePreferenceToggle"
        >
          <text class="tag-label">{{item.label}}</text>
        </view>
      </view>
    </view>
    
    <!-- 常去地点 -->
    <view class="preference-section">
      <view class="section-header">
        <text class="section-icon">📍</text>
        <text class="section-title">常去地点</text>
      </view>
      <view class="section-desc">选择或添加你常去的地方</view>
      <view class="options-row">
        <view 
          wx:for="{{frequentLocations}}" 
          wx:key="value"
          class="option-tag {{item.selected ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="onLocationToggle"
        >
          <text class="tag-label">{{item.label}}</text>
        </view>
      </view>
      <!-- 添加自定义地点 -->
      <view class="add-location-row">
        <input 
          class="location-input"
          placeholder="添加其他地点"
          value="{{customLocation}}"
          bindinput="onCustomLocationInput"
        />
        <view class="add-btn" bindtap="onAddCustomLocation">
          <t-icon name="add" size="32rpx" color="#5B75FB" />
        </view>
      </view>
    </view>
    
    <!-- 社交偏好 -->
    <view class="preference-section">
      <view class="section-header">
        <text class="section-icon">👥</text>
        <text class="section-title">社交偏好</text>
      </view>
      <view class="section-desc">你喜欢多大规模的活动</view>
      <view class="options-row">
        <view 
          wx:for="{{socialPreferences}}" 
          wx:key="value"
          class="option-tag {{item.selected ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="onSocialPreferenceToggle"
        >
          <text class="tag-label">{{item.label}}</text>
        </view>
      </view>
    </view>
    
    <!-- 底部占位 -->
    <view class="bottom-spacer"></view>
  </scroll-view>
  
  <!-- 保存按钮 -->
  <view class="save-bar">
    <button 
      class="save-btn {{isSaving ? 'disabled' : ''}}"
      bindtap="onSave"
      disabled="{{isSaving}}"
    >
      <t-loading wx:if="{{isSaving}}" theme="circular" size="32rpx" color="#fff" />
      <text wx:else>保存偏好</text>
    </button>
  </view>
</view>
